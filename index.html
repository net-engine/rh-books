<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title xmlns:d="http://docbook.org/ns/docbook">Power Management Guide</title>


<link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/>
<link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css"/>
<meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v3.9.9"/>
<meta xmlns:d="http://docbook.org/ns/docbook" name="package" content="Red_Hat_Enterprise_Linux-Power_Management_Guide-6-en-US-1.0-2"/>
</head>
<body>
<p id="title">
  <a class="left" href="http://www.redhat.com"><img alt="Product Site" src="Common_Content/images//image_left.png"/></a><a class="right" href="http://access.redhat.com/knowledge/docs/"><img alt="Documentation Site" src="Common_Content/images//image_right.png"/></a>
</p>
<div xml:lang="en-US" class="book" lang="en-US">
  <div class="titlepage">
    <div>
      <div class="producttitle">
        <span xmlns:d="http://docbook.org/ns/docbook" class="productname">Red Hat Enterprise Linux</span><span xmlns:d="http://docbook.org/ns/docbook" class="productnumber">6</span>
      </div>
      <div>
        <h1 class="title"><a id="idm236142897616"></a>Power Management Guide</h1>
      </div>
      <div>
        <h2 class="subtitle">Managing power consumption on Red Hat Enterprise Linux </h2>
      </div>
      <p xmlns:d="http://docbook.org/ns/docbook" class="edition">
        Edition 1.0
      </p>
      <div>
        <div xml:lang="en-US" class="authorgroup" lang="en-US">
          <div class="author">
            <h3 class="author">
            <span class="orgname">Red Hat Inc.</span>
            </h3>
          </div>
          <div class="author">
            <h3 class="author"><span class="firstname">Don</span><span class="surname">Domingo</span></h3>
            <div class="affiliation">
              <span xmlns:d="http://docbook.org/ns/docbook" class="orgname">Red Hat</span>
              <span xmlns:d="http://docbook.org/ns/docbook" class="orgdiv">Engineering Content Services</span>
            </div>
          </div>
          <div class="author">
            <h3 class="author"><span class="firstname">Ruediger</span><span class="surname">Landmann</span></h3>
            <div class="affiliation">
              <span xmlns:d="http://docbook.org/ns/docbook" class="orgname">Red Hat</span>
              <span xmlns:d="http://docbook.org/ns/docbook" class="orgdiv">Engineering Content Services</span>
            </div>
            <code class="email"><a class="email" href="mailto:r.landmann@redhat.com">r.landmann@redhat.com</a></code>
          </div>
        </div>
      </div>
      <div>
        <div class="author">
          <h3 class="author">
          <span class="orgname"><span class="inlinemediaobject"><object data="Common_Content/images/title_logo.svg" type="image/svg+xml"><img src="Common_Content/images/title_logo.png" alt="&#10;&#9;&#9;&#9;Logo&#10;&#9;&#9;"/></object></span>
          </span>
          </h3>
        </div>
      </div>
      <div>
        <div class="legalnotice">
          <a id="idm236142546208"></a>
          <h1 class="legalnotice">Legal Notice</h1>
          <div class="para">
             Copyright <span class="trademark"></span>© 2010 Red Hat Inc..
          </div>
          <div class="para">
             The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <code class="uri"><a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a></code>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
          </div>
          <div class="para">
             Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
          </div>
          <div class="para">
             Red Hat, Red Hat Enterprise Linux, the Shadowman logo, JBoss, MetaMatrix, Fedora, the Infinity Logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
          </div>
          <div class="para">
            <span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
          </div>
          <div class="para">
            <span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
          </div>
          <div class="para">
            <span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
          </div>
          <div class="para">
            <span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
          </div>
          <div class="para">
            <span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat Software Collections is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
          </div>
          <div class="para">
             The <span class="trademark">OpenStack</span>® Word Mark and OpenStack Logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
          </div>
          <div class="para">
             All other trademarks are the property of their respective owners.
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="toc">
    <dl class="toc">
      <dt><span class="preface"><a href="#pref-blank-Preface">Preface</a></span></dt>
      <dd>
      <dl>
        <dt><span class="section"><a href="#idm236148489568">1. Document Conventions</a></span></dt>
        <dd>
        <dl>
          <dt><span class="section"><a href="#idm236147412144">1.1. Typographic Conventions</a></span></dt>
          <dt><span class="section"><a href="#idm236142522896">1.2. Pull-quote Conventions</a></span></dt>
          <dt><span class="section"><a href="#idm236142515232">1.3. Notes and Warnings</a></span></dt>
        </dl>
        </dd>
        <dt><span class="section"><a href="#sect_RedHat-Getting_Help_and_Giving_Feedback">2. Getting Help and Giving Feedback</a></span></dt>
        <dd>
        <dl>
          <dt><span class="section"><a href="#sect_RedHat-Do_You_Need_Help">2.1. Do You Need Help?</a></span></dt>
          <dt><span class="section"><a href="#sect-RedHat-We_Need_Feedback">2.2. We Need Feedback!</a></span></dt>
        </dl>
        </dd>
      </dl>
      </dd>
      <dt><span class="chapter"><a href="#overview">1. Overview</a></span></dt>
      <dd>
      <dl>
        <dt><span class="section"><a href="#intro_importance">1.1. Importance of Power Management</a></span></dt>
        <dt><span class="section"><a href="#basics">1.2. Power Management Basics</a></span></dt>
      </dl>
      </dd>
      <dt><span class="chapter"><a href="#Audit_and_Analysis">2. Power management auditing and analysis</a></span></dt>
      <dd>
      <dl>
        <dt><span class="section"><a href="#Audit_and_analysis_overview">2.1. Audit and analysis overview</a></span></dt>
        <dt><span class="section"><a href="#PowerTOP">2.2. PowerTOP</a></span></dt>
        <dt><span class="section"><a href="#diskdevstat_and_netdevstat">2.3. Diskdevstat and netdevstat</a></span></dt>
        <dt><span class="section"><a href="#BLTK">2.4. Battery Life Tool Kit</a></span></dt>
        <dt><span class="section"><a href="#Tuned">2.5. Tuned and ktune</a></span></dt>
        <dd>
        <dl>
          <dt><span class="section"><a href="#The_tuned.conf_file">2.5.1. The <code class="filename">tuned.conf</code> file</a></span></dt>
          <dt><span class="section"><a href="#tuned-adm">2.5.2. Tuned-adm</a></span></dt>
        </dl>
        </dd>
        <dt><span class="section"><a href="#devicekit-power">2.6. DeviceKit-power and devkit-power</a></span></dt>
        <dt><span class="section"><a href="#gnome-power-manager">2.7. GNOME Power Manager</a></span></dt>
        <dt><span class="section"><a href="#Other_auditing">2.8. Other means for auditing</a></span></dt>
      </dl>
      </dd>
      <dt><span class="chapter"><a href="#Core_Infrastructure">3. Core Infrastructure and Mechanics</a></span></dt>
      <dd>
      <dl>
        <dt><span class="section"><a href="#C-States">3.1. CPU Idle States</a></span></dt>
        <dt><span class="section"><a href="#cpufreq_governors">3.2. Using <code class="command">CPUfreq</code> Governors</a></span></dt>
        <dd>
        <dl>
          <dt><span class="section"><a href="#governor_types">3.2.1. CPUfreq Governor Types</a></span></dt>
          <dt><span class="section"><a href="#cpufreq_setup">3.2.2. CPUfreq Setup</a></span></dt>
          <dt><span class="section"><a href="#tuning_cpufreq_policy_and_speed">3.2.3. Tuning CPUfreq Policy and Speed</a></span></dt>
        </dl>
        </dd>
        <dt><span class="section"><a href="#Suspend_and_Resume">3.3. Suspend and Resume</a></span></dt>
        <dt><span class="section"><a href="#Tickless-kernel">3.4. Tickless Kernel</a></span></dt>
        <dt><span class="section"><a href="#ASPM">3.5. Active-State Power Management</a></span></dt>
        <dt><span class="section"><a href="#ALPM">3.6. Aggressive Link Power Management</a></span></dt>
        <dt><span class="section"><a href="#Relatime">3.7. Relatime Drive Access Optimization</a></span></dt>
        <dt><span class="section"><a href="#Power_Capping">3.8. Power Capping</a></span></dt>
        <dt><span class="section"><a href="#Enhanced_Graphics_Power_Management">3.9. Enhanced Graphics Power Management</a></span></dt>
        <dt><span class="section"><a href="#RFKill">3.10. RFKill</a></span></dt>
        <dt><span class="section"><a href="#Optimizations_in_User_Space">3.11. Optimizations in User Space</a></span></dt>
      </dl>
      </dd>
      <dt><span class="chapter"><a href="#Use_Cases">4. Use Cases</a></span></dt>
      <dd>
      <dl>
        <dt><span class="section"><a href="#Example_Server">4.1. Example â Server</a></span></dt>
        <dt><span class="section"><a href="#Example_Laptop">4.2. Example â Laptop</a></span></dt>
      </dl>
      </dd>
      <dt><span class="appendix"><a href="#Developer_Tips">A. Tips for Developers</a></span></dt>
      <dd>
      <dl>
        <dt><span class="section"><a href="#Developer_Tips-Threads">A.1. Using Threads</a></span></dt>
        <dt><span class="section"><a href="#Developer_Tips-Wake-ups">A.2. Wake-ups</a></span></dt>
        <dt><span class="section"><a href="#Developer_Tips-Fsync">A.3. Fsync</a></span></dt>
      </dl>
      </dd>
      <dt><span class="appendix"><a href="#appe-Publican-Revision_History">B. Revision History</a></span></dt>
    </dl>
  </div>
  <div xml:lang="en-US" class="preface" lang="en-US">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a id="pref-blank-Preface"></a>Preface</h1>
        </div>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="idm236148489568"></a>1. Document Conventions</h2>
          </div>
        </div>
      </div>
      <div class="para">
         This manual uses several conventions to highlight certain words and phrases and draw attention to specific pieces of information.
      </div>
      <div class="para">
         In PDF and paper editions, this manual uses typefaces drawn from the <a href="https://fedorahosted.org/liberation-fonts/">Liberation Fonts</a> set. The Liberation Fonts set is also used in HTML editions if the set is installed on your system. If not, alternative but equivalent typefaces are displayed. Note: Red Hat Enterprise Linux 5 and later includes the Liberation Fonts set by default.
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="idm236147412144"></a>1.1. Typographic Conventions</h3>
            </div>
          </div>
        </div>
        <div class="para">
           Four typographic conventions are used to call attention to specific words and phrases. These conventions, and the circumstances they apply to, are as follows.
        </div>
        <div class="para">
          <code class="literal">Mono-spaced Bold</code>
        </div>
        <div class="para">
           Used to highlight system input, including shell commands, file names and paths. Also used to highlight keycaps and key combinations. For example:
        </div>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="para">
               To see the contents of the file <code class="filename">my_next_bestselling_novel</code> in your current working directory, enter the <code class="command">cat my_next_bestselling_novel</code> command at the shell prompt and press <span class="keycap"><strong>Enter</strong></span> to execute the command.
            </div>
          </blockquote>
        </div>
        <div class="para">
           The above includes a file name, a shell command and a keycap, all presented in mono-spaced bold and all distinguishable thanks to context.
        </div>
        <div class="para">
           Key combinations can be distinguished from keycaps by the plus sign that connects each part of a key combination. For example:
        </div>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="para">
               Press <span class="keycap"><strong>Enter</strong></span> to execute the command.
            </div>
            <div class="para">
               Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span> to switch to a virtual terminal.
            </div>
          </blockquote>
        </div>
        <div class="para">
           The first paragraph highlights the particular keycap to press. The second highlights two key combinations (each a set of three keycaps with each set pressed simultaneously).
        </div>
        <div class="para">
           If source code is discussed, class names, methods, functions, variable names and returned values mentioned within a paragraph will be presented as above, in <code class="literal">mono-spaced bold</code>. For example:
        </div>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="para">
               File-related classes include <code class="classname">filesystem</code> for file systems, <code class="classname">file</code> for files, and <code class="classname">dir</code> for directories. Each class has its own associated set of permissions.
            </div>
          </blockquote>
        </div>
        <div class="para">
          <span class="application"><strong>Proportional Bold</strong></span>
        </div>
        <div class="para">
           This denotes words or phrases encountered on a system, including application names; dialog box text; labeled buttons; check-box and radio button labels; menu titles and sub-menu titles. For example:
        </div>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="para">
               Choose <span class="guimenu"><strong>System</strong></span> → <span class="guisubmenu"><strong>Preferences</strong></span> → <span class="guimenuitem"><strong>Mouse</strong></span> from the main menu bar to launch <span class="application"><strong>Mouse Preferences</strong></span>. In the <span class="guilabel"><strong>Buttons</strong></span> tab, click the <span class="guilabel"><strong>Left-handed mouse</strong></span> check box and click <span class="guibutton"><strong>Close</strong></span> to switch the primary mouse button from the left to the right (making the mouse suitable for use in the left hand).
            </div>
            <div class="para">
               To insert a special character into a <span class="application"><strong>gedit</strong></span> file, choose <span class="guimenu"><strong>Applications</strong></span> → <span class="guisubmenu"><strong>Accessories</strong></span> → <span class="guimenuitem"><strong>Character Map</strong></span> from the main menu bar. Next, choose <span class="guimenu"><strong>Search</strong></span> → <span class="guimenuitem"><strong>Find…</strong></span> from the <span class="application"><strong>Character Map</strong></span> menu bar, type the name of the character in the <span class="guilabel"><strong>Search</strong></span> field and click <span class="guibutton"><strong>Next</strong></span>. The character you sought will be highlighted in the <span class="guilabel"><strong>Character Table</strong></span>. Double-click this highlighted character to place it in the <span class="guilabel"><strong>Text to copy</strong></span> field and then click the <span class="guibutton"><strong>Copy</strong></span> button. Now switch back to your document and choose <span class="guimenu"><strong>Edit</strong></span> → <span class="guimenuitem"><strong>Paste</strong></span> from the <span class="application"><strong>gedit</strong></span> menu bar.
            </div>
          </blockquote>
        </div>
        <div class="para">
           The above text includes application names; system-wide menu names and items; application-specific menu names; and buttons and text found within a GUI interface, all presented in proportional bold and all distinguishable by context.
        </div>
        <div class="para">
          <code class="command"><em class="replaceable"><code>Mono-spaced Bold Italic</code></em></code> or <span class="application"><strong><em class="replaceable"><code>Proportional Bold Italic</code></em></strong></span>
        </div>
        <div class="para">
           Whether mono-spaced bold or proportional bold, the addition of italics indicates replaceable or variable text. Italics denotes text you do not input literally or displayed text that changes depending on circumstance. For example:
        </div>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="para">
               To connect to a remote machine using ssh, type <code class="command">ssh <em class="replaceable"><code>username</code></em>@<em class="replaceable"><code>domain.name</code></em></code> at a shell prompt. If the remote machine is <code class="filename">example.com</code> and your username on that machine is john, type <code class="command">ssh john@example.com</code>.
            </div>
            <div class="para">
               The <code class="command">mount -o remount <em class="replaceable"><code>file-system</code></em></code> command remounts the named file system. For example, to remount the <code class="filename">/home</code> file system, the command is <code class="command">mount -o remount /home</code>.
            </div>
            <div class="para">
               To see the version of a currently installed package, use the <code class="command">rpm -q <em class="replaceable"><code>package</code></em></code> command. It will return a result as follows: <code class="command"><em class="replaceable"><code>package-version-release</code></em></code>.
            </div>
          </blockquote>
        </div>
        <div class="para">
           Note the words in bold italics above — username, domain.name, file-system, package, version and release. Each word is a placeholder, either for text you enter when issuing a command or for text displayed by the system.
        </div>
        <div class="para">
           Aside from standard usage for presenting the title of a work, italics denotes the first use of a new and important term. For example:
        </div>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="para">
               Publican is a <em class="firstterm">DocBook</em> publishing system.
            </div>
          </blockquote>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="idm236142522896"></a>1.2. Pull-quote Conventions</h3>
            </div>
          </div>
        </div>
        <div class="para">
           Terminal output and source code listings are set off visually from the surrounding text.
        </div>
        <div class="para">
           Output sent to a terminal is set in <code class="computeroutput">mono-spaced roman</code> and presented thus:
        </div>
        <pre class="screen">
          books        Desktop   documentation  drafts  mss    photos   stuff  svn
          books_tests  Desktop1  downloads      images  notes  scripts  svgs
        </pre>
        <div class="para">
          Source-code listings are also set in <code class="computeroutput">mono-spaced roman</code> but add syntax highlighting as follows:
        </div>
        <pre xml:lang="en-US" class="programlisting" lang="en-US"><span class="perl_DataType">static</span> <span class="perl_DataType">int</span> kvm_vm_ioctl_deassign_device(<span class="perl_Keyword">struct</span> kvm *kvm,
                 <span class="perl_Keyword">struct</span> kvm_assigned_pci_dev *assigned_dev)
{
         <span class="perl_DataType">int</span> r = 0;
         <span class="perl_Keyword">struct</span> kvm_assigned_dev_kernel *match;

         mutex_lock(&amp;kvm-&gt;lock);

         match = kvm_find_assigned_dev(&amp;kvm-&gt;arch.assigned_dev_head,
                                       assigned_dev-&gt;assigned_dev_id);
         <span class="perl_Keyword">if</span> (!match) {
                 printk(KERN_INFO <span class="perl_String">"%s: device hasn't been assigned before, "</span>
                   <span class="perl_String">"so cannot be deassigned</span><span class="perl_Char">\n</span><span class="perl_String">"</span>, __func__);
                 r = -EINVAL;
                 <span class="perl_Keyword">goto</span> out;
         }

         kvm_deassign_device(kvm, match);

         kvm_free_assigned_device(kvm, match);

out:
         mutex_unlock(&amp;kvm-&gt;lock);
         <span class="perl_Keyword">return</span> r;
}</pre>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="idm236142515232"></a>1.3. Notes and Warnings</h3>
            </div>
          </div>
        </div>
        <div class="para">
           Finally, we use three visual styles to draw attention to information that might otherwise be overlooked.
        </div>
        <div xmlns:d="http://docbook.org/ns/docbook" class="note">
          <div class="admonition_header">
            <p>
              <strong>Note</strong>
            </p>
          </div>
          <div class="admonition">
            <div class="para">
               Notes are tips, shortcuts or alternative approaches to the task at hand. Ignoring a note should have no negative consequences, but you might miss out on a trick that makes your life easier.
            </div>
          </div>
        </div>
        <div xmlns:d="http://docbook.org/ns/docbook" class="important">
          <div class="admonition_header">
            <p>
              <strong>Important</strong>
            </p>
          </div>
          <div class="admonition">
            <div class="para">
               Important boxes detail things that are easily missed: configuration changes that only apply to the current session, or services that need restarting before an update will apply. Ignoring a box labeled 'Important' will not cause data loss but may cause irritation and frustration.
            </div>
          </div>
        </div>
        <div xmlns:d="http://docbook.org/ns/docbook" class="warning">
          <div class="admonition_header">
            <p>
              <strong>Warning</strong>
            </p>
          </div>
          <div class="admonition">
            <div class="para">
               Warnings should not be ignored. Ignoring warnings will most likely cause data loss.
            </div>
          </div>
        </div>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="sect_RedHat-Getting_Help_and_Giving_Feedback"></a>2. Getting Help and Giving Feedback</h2>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="sect_RedHat-Do_You_Need_Help"></a>2.1. Do You Need Help?</h3>
            </div>
          </div>
        </div>
        <a id="idm236142503728" class="indexterm"></a>
        <div class="para">
           If you experience difficulty with a procedure described in this documentation, visit the Red Hat Customer Portal at <code class="uri"><a class="uri" href="http://access.redhat.com">http://access.redhat.com</a></code>. Through the customer portal, you can:
        </div>
        <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
          <ul>
            <li class="listitem">
            <div class="para">
               search or browse through a knowledgebase of technical support articles about Red Hat products.
            </div>
            </li>
            <li class="listitem">
            <div class="para">
               submit a support case to Red Hat Global Support Services (GSS).
            </div>
            </li>
            <li class="listitem">
            <div class="para">
               access other product documentation.
            </div>
            </li>
          </ul>
        </div>
        <div class="para">
           Red Hat also hosts a large number of electronic mailing lists for discussion of Red Hat software and technology. You can find a list of publicly available mailing lists at <code class="uri"><a class="uri" href="https://www.redhat.com/mailman/listinfo">https://www.redhat.com/mailman/listinfo</a></code>. Click on the name of any mailing list to subscribe to that list or to access the list archives.
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="sect-RedHat-We_Need_Feedback"></a>2.2. We Need Feedback!</h3>
            </div>
          </div>
        </div>
        <a id="idm236142494528" class="indexterm"></a>
        <div class="para">
           If you find a typographical error in this manual, or if you have thought of a way to make this manual better, we would love to hear from you! Please submit a report in Bugzilla: <a href="http://bugzilla.redhat.com/">http://bugzilla.redhat.com/</a> against the product <span class="application"><strong>Red_Hat_Enterprise_Linux.</strong></span>
        </div>
        <div class="para">
           When submitting a bug report, be sure to mention the manual's identifier: <em class="citetitle">doc-Power_Management_Guide</em>
        </div>
        <div class="para">
           If you have a suggestion for improving the documentation, try to be as specific as possible when describing it. If you have found an error, please include the section number and some of the surrounding text so we can find it easily.
        </div>
      </div>
    </div>
  </div>
  <div xml:lang="en-US" class="chapter" lang="en-US">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a id="overview"></a>Overview</h1>
        </div>
      </div>
    </div>
    <div class="toc">
      <dl class="toc">
        <dt><span class="section"><a href="#intro_importance">1.1. Importance of Power Management</a></span></dt>
        <dt><span class="section"><a href="#basics">1.2. Power Management Basics</a></span></dt>
      </dl>
    </div>
    <div class="para">
       Power management has been one of our focus points for improvements for Red Hat Enterprise Linux 6. Limiting the power used by computer systems is one of the most important aspects of <em class="firstterm">green IT</em> (environmentally friendly computing), a set of considerations that also encompasses the use of recyclable materials, the environmental impact of hardware production, and environmental awareness in the design and deployment of systems. In this document, we provide guidance and information regarding power management of your systems running Red Hat Enterprise Linux 6.
    </div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="intro_importance"></a>1.1. Importance of Power Management</h2>
          </div>
        </div>
      </div>
      <a id="idm236142486272" class="indexterm"></a>
      <a id="idm236142481904" class="indexterm"></a>
      <div class="para">
         At the core of power management is an understanding of how to effectively optimize energy consumption of each system component. This entails studying the different tasks that your system performs, and configuring each component to ensure that its performance is just right for the job.
      </div>
      <div class="para">
         The main motivator for power management is:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
             reducing overall power consumption to save cost
          </div>
          </li>
        </ul>
      </div>
      <div class="para">
         The proper use of power management results in:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
             heat reduction for servers and computing centers
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             reduced secondary costs, including cooling, space, cables, generators, and <em class="firstterm">uninterruptible power supplies</em> (UPS)
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             extended battery life for laptops
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             lower carbon dioxide output
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             meeting government regulations or legal requirements regarding Green IT, for example Energy Star
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             meeting company guidelines for new systems
          </div>
          </li>
        </ul>
      </div>
      <div class="para">
         As a rule, lowering the power consumption of a specific component (or of the system as a whole) will lead to lower heat and naturally, performance. As such, you should thoroughly study and test the decrease in performance afforded by any configurations you make, especially for mission-critical systems.
      </div>
      <div class="para">
         By studying the different tasks that your system performs, and configuring each component to ensure that its performance is just sufficient for the job, you can save energy, generate less heat, and optimize battery life for laptops. Many of the principles for analysis and tuning of a system in regard to power consumption are similar to those for performance tuning. To some degree, power management and performance tuning are opposite approaches to system configuration, because systems are usually optimized either towards performance or power. This manual describes the tools that Red Hat provides and the techniques we have developed to help you in this process.
      </div>
      <div class="para">
         Red Hat Enterprise Linux 6 already comes with a lot of new power management features that are enabled by default. They were all selectively chosen to not impact the performance of a typical server or desktop use case. However, for very specific use cases where maximum throughput, lowest latency, or highest CPU performance is absolutely required, a review of those defaults might be necessary.
      </div>
      <div class="para">
         To decide whether you should optimize your machines using the techniques described in this document, ask yourself a few questions:
      </div>
      <div class="qandaset">
        <a id="idm236142467328"></a>
        <dl>
          <dt>Q: <a href="#idm236142467072">
          Must I optimize? </a></dt>
          <dt>Q: <a href="#idm236142464576">
          How much do I need to optimize? </a></dt>
          <dt>Q: <a href="#idm236142461824">
          Will optimization reduce system performance to an unacceptable level? </a></dt>
          <dt>Q: <a href="#idm236142459072">
          Will the time and resources spent to optimize the system outweigh the gains achieved? </a></dt>
        </dl>
        <div xmlns:d="http://docbook.org/ns/docbook" class="qandaset">
          <div class="qandaentry">
            <div class="question">
              <a id="idm236142467072"></a>
              <div class="label">
                Q:
              </div>
              <div class="data">
                <div class="para">
                   Must I optimize?
                </div>
              </div>
            </div>
            <div class="answer">
              <div class="label">
                A:
              </div>
              <div class="data">
                <div class="para">
                   The importance of power optimization depends on whether your company has guidelines that need to be followed or if there are any regulations that you have to fulfill.
                </div>
              </div>
            </div>
          </div>
          <div class="qandaentry">
            <div class="question">
              <a id="idm236142464576"></a>
              <div class="label">
                Q:
              </div>
              <div class="data">
                <div class="para">
                   How much do I need to optimize?
                </div>
              </div>
            </div>
            <div class="answer">
              <div class="label">
                A:
              </div>
              <div class="data">
                <div class="para">
                   Several of the techniques we present do not require you to go through the whole process of auditing and analyzing your machine in detail but instead offer a set of general optimizations that typically improve power usage. Those will of course typically not be as good as a manually audited and optimized system, but provide a good compromise.
                </div>
              </div>
            </div>
          </div>
          <div class="qandaentry">
            <div class="question">
              <a id="idm236142461824"></a>
              <div class="label">
                Q:
              </div>
              <div class="data">
                <div class="para">
                   Will optimization reduce system performance to an unacceptable level?
                </div>
              </div>
            </div>
            <div class="answer">
              <div class="label">
                A:
              </div>
              <div class="data">
                <div class="para">
                   Most of the techniques described in this document impact the performance of your system noticeably. If you choose to implement power management beyond the defaults already in place in Red Hat Enterprise Linux 6, you should monitor the performance of the system after power optimization and decide if the performance loss is acceptable.
                </div>
              </div>
            </div>
          </div>
          <div class="qandaentry">
            <div class="question">
              <a id="idm236142459072"></a>
              <div class="label">
                Q:
              </div>
              <div class="data">
                <div class="para">
                   Will the time and resources spent to optimize the system outweigh the gains achieved?
                </div>
              </div>
            </div>
            <div class="answer">
              <div class="label">
                A:
              </div>
              <div class="data">
                <div class="para">
                   Optimizing a single system manually following the whole process is typically not worth it as the time and cost spent doing so is far higher than the typical benefit you would get over the lifetime of a single machine. On the other hand if you for example roll out 10000 desktop systems to your offices all using the same configuration and setup then creating one optimized setup and applying that to all 10000 machines is most likely a good idea.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="para">
         The following sections will explain how optimal hardware performance benefits your system in terms of energy consumption.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="basics"></a>1.2. Power Management Basics</h2>
          </div>
        </div>
      </div>
      <a id="idm236142454384" class="indexterm"></a>
      <a id="idm236142452032" class="indexterm"></a>
      <div class="para">
         Effective power management is built on the following principles:
      </div>
      <a id="idm236142450112" class="indexterm"></a>
      <a id="idm236142448736" class="indexterm"></a>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          An idle CPU should only wake up when needed
        </div>
         The Red Hat Enterprise Linux 5 kernel used a periodic timer for each CPU. This timer prevents the CPU from truly going idle, as it requires the CPU to process each timer event (which would happen every few milliseconds, depending on the setting), regardless of whether any process was running or not. A large part of effective power management involves reducing the frequency at which CPU wakeups are made.
      </div>
      <div class="para">
         Because of this, the Linux kernel in Red Hat Enterprise Linux 6 eliminates the periodic timer: as a result, the idle state of a CPU is now <em class="firstterm">tickless</em>. This prevents the CPU from consuming unnecessary power when it is idle. However, benefits from this feature can be offset if your system has applications that create unnecessary timer events. Polling events (such as checks for volume changes, mouse movement, and the like) are examples of such events.
      </div>
      <div class="para">
         Red Hat Enterprise Linux 6 includes tools with which you can identify and audit applications on the basis of their CPU usage. Refer to <a class="xref" href="#Audit_and_Analysis">Chapter 2, <em>Power management auditing and analysis</em></a> for details.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Unused hardware and devices should be disabled completely
        </div>
         This is especially true for devices that have moving parts (for example, hard disks). In addition to this, some applications may leave an unused but enabled device "open"; when this occurs, the kernel assumes that the device is in use, which can prevent the device from going into a power saving state.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Low activity should translate to low wattage
        </div>
         In many cases, however, this depends on modern hardware and correct BIOS configuration. Older system components often do not have support for some of the new features that we now can support in Red Hat Enterprise Linux 6. Make sure that you are using the latest official firmware for your systems and that in the power management or device configuration sections of the BIOS the power management features are enabled. Some features to look for include:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
             SpeedStep
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             PowerNow!
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             Cool'n'Quiet
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             ACPI (C state)
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             Smart
          </div>
          </li>
        </ul>
      </div>
      <div class="para">
         If your hardware has support for these features and they are enabled in the BIOS, Red Hat Enterprise Linux 6 will use them by default.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Different forms of CPU states and their effects
        </div>
         Modern CPUs together with <em class="firstterm">Advanced Configuration and Power Interface</em> (ACPI) provide different power states. The three different states are:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
             Sleep (C-states)
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             Frequency (P-states)
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             Heat output (T-states or "thermal states")
          </div>
          </li>
        </ul>
      </div>
      <div class="para">
         A CPU running on the lowest sleep state possible consumes the least amount of watts, but it also takes considerably more time to wake it up from that state when needed. In very rare cases this can lead to the CPU having to wake up immediately every time it just went to sleep. This situation results in an effectively permanently busy CPU and loses some of the potential power saving if another state had been used.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          A turned off machine uses the least amount of power
        </div>
         As obvious as this might sound, one of the best ways to actually save power is to turn off systems. For example, your company can develop a corporate culture focused on "green IT" awareness with a guideline to turn of machines during lunch break or when going home. You also might consolidate several physical servers into one bigger server and virtualize them using the virtualization technology we ship with Red Hat Enterprise Linux 6.
      </div>
    </div>
  </div>
  <div class="chapter">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a id="Audit_and_Analysis"></a>Power management auditing and analysis</h1>
        </div>
      </div>
    </div>
    <div class="toc">
      <dl class="toc">
        <dt><span class="section"><a href="#Audit_and_analysis_overview">2.1. Audit and analysis overview</a></span></dt>
        <dt><span class="section"><a href="#PowerTOP">2.2. PowerTOP</a></span></dt>
        <dt><span class="section"><a href="#diskdevstat_and_netdevstat">2.3. Diskdevstat and netdevstat</a></span></dt>
        <dt><span class="section"><a href="#BLTK">2.4. Battery Life Tool Kit</a></span></dt>
        <dt><span class="section"><a href="#Tuned">2.5. Tuned and ktune</a></span></dt>
        <dd>
        <dl>
          <dt><span class="section"><a href="#The_tuned.conf_file">2.5.1. The <code class="filename">tuned.conf</code> file</a></span></dt>
          <dt><span class="section"><a href="#tuned-adm">2.5.2. Tuned-adm</a></span></dt>
        </dl>
        </dd>
        <dt><span class="section"><a href="#devicekit-power">2.6. DeviceKit-power and devkit-power</a></span></dt>
        <dt><span class="section"><a href="#gnome-power-manager">2.7. GNOME Power Manager</a></span></dt>
        <dt><span class="section"><a href="#Other_auditing">2.8. Other means for auditing</a></span></dt>
      </dl>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Audit_and_analysis_overview"></a>2.1. Audit and analysis overview</h2>
          </div>
        </div>
      </div>
      <a id="idm236085951152" class="indexterm"></a>
      <div class="para">
         The detailed manual audit, analysis, and tuning of a single system is usually the exception because the time and cost spent to do so typically outweighs the benefits gained from these last pieces of system tuning. However, performing these tasks once for a large number of nearly identical systems where you can reuse the same settings for all systems can be very useful. For example, consider the deployment of thousands of desktop systems, or a HPC cluster where the machines are nearly identical. Another reason to do auditing and analysis is to provide a basis for comparison against which you can identify regressions or changes in system behavior in the future. The results of this analysis can be very helpful in cases where hardware, BIOS, or software updates happen regularly and you want to avoid any surprises with regard to power consumption. Generally, a thorough audit and analysis gives you a much better idea of what is really happening on a particular system.
      </div>
      <div class="para">
         Auditing and analyzing a system with regard to power consumption is relatively hard, even with the most modern systems available. Most systems do not provide the necessary means to measure power use via software. Exceptions exist though: the ILO management console of Hewlett Packard server systems has a power management module that you can access through the web. IBM provides a similar solution in their BladeCenter power management module. On some Dell systems, the IT Assistant offers power monitoring capabilities as well. Other vendors are likely to offer similar capabilities for their server platforms, but as can be seen there is no single solution available that is supported by all vendors. If your system has no inbuilt mechanism to measure power consumption, a few other choices exist. You could install a special power supply for your system that offers power consumption information through USB. The Gigabyte <span class="hardware">Odin GT</span> 550W PC power supply is one such example, and software to read out those values under Linux is available externally from <code class="uri"><a class="uri" href="http://mgmt.sth.sze.hu/~andras/dev/gopsu/">http://mgmt.sth.sze.hu/~andras/dev/gopsu/</a></code>. As a last resort, some external watt meters like the <span class="hardware">Watts up? PRO</span> have a USB connector.
      </div>
      <div class="para">
         Direct measurements of power consumption is often only necessary to maximize savings as far as possible. Fortunately, other means are available to measure if changes are in effect or how the system is behaving. This chapter describes the necessary tools.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="PowerTOP"></a>2.2. PowerTOP</h2>
          </div>
        </div>
      </div>
      <div class="para">
         The introduction of the tickless kernel in Red Hat Enterprise Linux 6 (refer to <a class="xref" href="#Tickless-kernel">Section 3.4, “Tickless Kernel”</a>) allows the CPU to enter the idle state more frequently, reducing power consumption and improving power management. The new <span class="application"><strong>PowerTOP</strong></span> tool identifies specific components of kernel and userspace applications that frequently wake up the CPU. <span class="application"><strong>PowerTOP</strong></span> was used in development to perform the audits described in <a class="xref" href="#Optimizations_in_User_Space">Section 3.11, “Optimizations in User Space”</a> that led to many applications being tuned in this release, reducing unnecessary CPU wake up by a factor of ten.
      </div>
      <div class="para">
         Install <span class="application"><strong>PowerTOP</strong></span> with the command:
      </div>
      <pre class="screen">
        <code class="command">yum install powertop</code>
      </pre>
      <div class="para">
         Run <span class="application"><strong>PowerTOP</strong></span> with the command:
      </div>
      <pre class="screen">
        <code class="command">powertop</code>
      </pre>
      <div class="para">
         Note that you will need to run <span class="application"><strong>PowerTOP</strong></span> with root privileges to allow the application to do anything useful.
      </div>
      <div class="para">
         When it runs, <span class="application"><strong>PowerTOP</strong></span> gathers statistics from the system and presents you with a list of the components that are sending wakeups to the CPU most frequently. <span class="application"><strong>PowerTOP</strong></span> also makes suggestions for tuning the system for lower power consumption. These suggestions appear at the bottom of the screen, and specify a key for you to press to accept <span class="application"><strong>PowerTOP</strong></span>'s suggestion. As <span class="application"><strong>PowerTOP</strong></span> refreshes periodically, further suggestions appear. In <a class="xref" href="#fig-PowerTOP">Figure 2.1, “PowerTOP in Operation”</a>, note the suggestion to <code class="literal">increase the VM dirty writeback time</code>, and the key (<span class="keycap"><strong>W</strong></span>) to press to accept the suggestion.
      </div>
      <div class="para">
         When it runs, <span class="application"><strong>PowerTOP</strong></span> gathers statistics from the system and presents you with several important lists of information. At the top is a list of how long your CPU cores have been in each of the available C and P states. The longer the CPU stays in the higher C or P stats the better (<code class="literal">C4</code> being higher than <code class="literal">C3</code>) and is a good indicator of how well the system is tuned towards CPU utilization. Your goal should be residency of 90% or more in the highest C or P state while the system is idle.
      </div>
      <div class="para">
         The second piece of information is a summary of the actual wakeups per second of the machine. The number of wakeups per second gives you a good measure of how well the services or the devices and drivers of the kernel are performing with regard to power usage on your system. The more wakeups per second you have, the more power is consumed, so lower is better here.
      </div>
      <div class="para">
         Next, <span class="application"><strong>PowerTOP</strong></span> provides an estimate of the actual power usage of the system, if available. Expect <span class="application"><strong>PowerTOP</strong></span> to report this figure on laptops while they are in battery mode.
      </div>
      <div class="para">
         Any available estimates of power usage are followed by a detailed list of the components that send wakeups to the CPU most frequently. At the top of the list are those components that you should investigate more closely to optimize your system to reduce power usage. If they are kernel components, (indicated by the name of the component being listed in <code class="literal">&lt;</code><code class="literal"></code>) then the wakeups are often associated with a specific driver that causes them. Tuning drivers most usually requires kernel changes which go beyond the scope of this document. However, userland processes that send wakeups are more easily managed. First, identify if this service or application should run at all on this system. If not, simply deactivate it. To turn off a service permanently, run:
      </div>
      <pre class="screen">
        <code class="command">chkconfig <em class="replaceable"><code>servicename</code></em> off</code>
      </pre>
      <div class="para">
         If you need more details about the what the component actually does, run:
      </div>
      <pre class="screen">
        <code class="command">ps -awux | grep <em class="replaceable"><code>componentname</code></em></code>
        <code class="command">strace -p <em class="replaceable"><code>processid</code></em></code>
      </pre>
      <div class="para">
         If the trace looks like it is repeating itself, then you probably have found a busy loop. To fix this would require a code change in that component and that again goes beyond the scope of this document.
      </div>
      <div class="para">
         Finally, <span class="application"><strong>PowerTOP</strong></span> also makes suggestions for tuning the system for lower power consumption. These suggestions appear at the bottom of the screen, and specify a key for you to press to accept <span class="application"><strong>PowerTOP</strong></span>'s suggestion. As <span class="application"><strong>PowerTOP</strong></span> refreshes periodically, further suggestions appear. In <a class="xref" href="#fig-PowerTOP">Figure 2.1, “PowerTOP in Operation”</a>, note the suggestion to <code class="literal">increase the VM dirty writeback time</code>, and the key (<span class="keycap"><strong>W</strong></span>) to press to accept the suggestion. These changes will only be active until the next reboot. To help you make the changes permanent, <span class="application"><strong>PowerTOP</strong></span> displays the exact command it runs to perform this optimization. Add the command to your <code class="filename">/etc/rc.local</code> file with your preferred text editor so that it takes effect every time that the computer starts.
      </div>
      <div class="figure">
        <a id="fig-PowerTOP"></a>
        <div class="figure-contents">
          <div class="mediaobject">
            <img src="images/powertop.png" alt="PowerTOP in Operation"/>
          </div>
        </div>
        <p class="title">
          <strong>Figure 2.1. PowerTOP in Operation</strong>
        </p>
      </div>
      <br class="figure-break"/>
      <div class="para">
         The <em class="citetitle">Less Watts</em> website publishes a list of applications that <span class="application"><strong>PowerTOP</strong></span> has identified as keeping CPUs active. Refer to <code class="uri"><a class="uri" href="http://www.lesswatts.org/projects/powertop/known.php">http://www.lesswatts.org/projects/powertop/known.php</a></code>.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="diskdevstat_and_netdevstat"></a>2.3. Diskdevstat and netdevstat</h2>
          </div>
        </div>
      </div>
      <a id="idm236142378608" class="indexterm"></a>
      <a id="idm236142376784" class="indexterm"></a>
      <a id="idm236142375728" class="indexterm"></a>
      <a id="idm236142374320" class="indexterm"></a>
      <div class="para">
        <span class="application"><strong>Diskdevstat</strong></span> and <span class="application"><strong>netdevstat</strong></span> are <span class="application"><strong>SystemTap</strong></span> tools that collect detailed information about the disk activity and network activity of all applications running on a system. These tools were inspired by <span class="application"><strong>PowerTOP</strong></span>, which shows the number of CPU wakeups by every application per second (refer to <a class="xref" href="#PowerTOP">Section 2.2, “PowerTOP”</a>). The statistics that these tools collect allow you to identify applications that waste power with many small I/O operations rather than fewer, larger operations. Other monitoring tools that measure only transfer speeds do not help to identify this type of usage.
      </div>
      <div class="para">
         Install these tools with <span class="application"><strong>SystemTap</strong></span> with the command:
      </div>
      <pre class="screen">
        <code class="command">yum install systemtap tuned-utils kernel-debuginfo</code>
      </pre>
      <div class="para">
         Run the tools with the command:
      </div>
      <pre class="screen">
        <code class="command">diskdevstat</code>
      </pre>
      <div class="para">
         or the command:
      </div>
      <pre class="screen">
        <code class="command">netdevstat</code>
      </pre>
      <div class="para">
         Both commands can take up to three parameters, as follows:
      </div>
      <div class="para">
        <code class="command">diskdevstat <em class="replaceable"><code>update_interval</code></em><em class="replaceable"><code>total_duration</code></em><em class="replaceable"><code>display_histogram</code></em></code>
      </div>
      <div class="para">
        <code class="command">netdevstat <em class="replaceable"><code>update_interval</code></em><em class="replaceable"><code>total_duration</code></em><em class="replaceable"><code>display_histogram</code></em></code>
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><em class="replaceable"><code>update_interval</code></em></span></dt>
          <dd>
          <div class="para">
             The time in seconds between updates of the display. Default: <code class="literal">5</code>
          </div>
          </dd>
          <dt><span class="term"><em class="replaceable"><code>total_duration</code></em></span></dt>
          <dd>
          <div class="para">
             The time in seconds for the whole run. Default: <code class="literal">86400</code> (1 day)
          </div>
          </dd>
          <dt><span class="term"><em class="replaceable"><code>display_histogram</code></em></span></dt>
          <dd>
          <div class="para">
             Flag whether to histogram for all the collected data at the end of the run.
          </div>
          </dd>
        </dl>
      </div>
      <div class="para">
         The output resembles that of <span class="application"><strong>PowerTOP</strong></span>. Here is sample output from a longer <span class="application"><strong>diskdevstat</strong></span> run on a Fedora10 system running KDE4.2:
      </div>
      <pre class="screen">  
        PID    UID DEV     WRITE_CNT WRITE_MIN WRITE_MAX WRITE_AVG    READ_CNT  READ_MIN  READ_MAX  READ_AVG COMMAND
        2789  2903 sda1          854     0.000   120.000    39.836           0     0.000     0.000     0.000 plasma
        2573     0 sda1           63     0.033  3600.015   515.226           0     0.000     0.000     0.000 auditd
        2153     0 sda1           26     0.003  3600.029  1290.730           0     0.000     0.000     0.000 rsyslogd
      </pre>
      <div class="para">
         The columns are:
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term">PID</span></dt>
          <dd>
          <div class="para">
             the process ID of the application
          </div>
          </dd>
          <dt><span class="term">UID</span></dt>
          <dd>
          <div class="para">
             the user ID under which the applications is running
          </div>
          </dd>
          <dt><span class="term">DEV</span></dt>
          <dd>
          <div class="para">
             the device on which the I/O took place
          </div>
          </dd>
          <dt><span class="term">WRITE_CNT</span></dt>
          <dd>
          <div class="para">
             the total number of write operations
          </div>
          </dd>
          <dt><span class="term">WRITE_MIN</span></dt>
          <dd>
          <div class="para">
             the lowest time taken for two consecutive writes (in seconds)
          </div>
          </dd>
          <dt><span class="term">WRITE_MAX</span></dt>
          <dd>
          <div class="para">
             the greatest time taken for two consecutive writes (in seconds)
          </div>
          </dd>
          <dt><span class="term">WRITE_AVG</span></dt>
          <dd>
          <div class="para">
             the average time taken for two consecutive writes (in seconds)
          </div>
          </dd>
          <dt><span class="term">READ_CNT</span></dt>
          <dd>
          <div class="para">
             the total number of read operations
          </div>
          </dd>
          <dt><span class="term">READ_MIN</span></dt>
          <dd>
          <div class="para">
             the lowest time taken for two consecutive reads (in seconds)
          </div>
          </dd>
          <dt><span class="term">READ_MAX</span></dt>
          <dd>
          <div class="para">
             the greatest time taken for two consecutive reads (in seconds)
          </div>
          </dd>
          <dt><span class="term">READ_AVG</span></dt>
          <dd>
          <div class="para">
             the average time taken for two consecutive reads (in seconds)
          </div>
          </dd>
          <dt><span class="term">COMMAND</span></dt>
          <dd>
          <div class="para">
             the name of the process
          </div>
          </dd>
        </dl>
      </div>
      <div class="para">
         In this example, three very obvious applications stand out:
      </div>
      <pre class="screen">
         PID UID DEV WRITE_CNT WRITE_MIN WRITE_MAX WRITE_AVG READ_CNT READ_MIN READ_MAX READ_AVG COMMAND 2789 2903 sda1 854 0.000 120.000 39.836 0 0.000 0.000 0.000 plasma 2573 0 sda1 63 0.033 3600.015 515.226 0 0.000 0.000 0.000 auditd 2153 0 sda1 26 0.003 3600.029 1290.730 0 0.000 0.000 0.000 rsyslogd
      </pre>
      <div class="para">
         These three applications have a <code class="literal">WRITE_CNT</code> greater than <code class="literal">0</code>, which means that they performed some form of write during the measurement. Of those, <span class="application"><strong>plasma</strong></span> was the worst offender by a large degree: it performed the most write operations, and of course the average time between writes was the lowest. <span class="application"><strong>Plasma</strong></span> would therefore be the best candidate to investigate if you were concerned about power-inefficient applications.
      </div>
      <div class="para">
         Use the <span class="application"><strong>strace</strong></span> and <span class="application"><strong>ltrace</strong></span> commands to examine applications more closely by tracing all system calls of the given process ID. In the present example, you could run:
      </div>
      <pre class="screen">
        <code class="command">strace -p 2789</code>
      </pre>
      <div class="para">
         In this example, the output of the <code class="command">strace</code> contained a repeating pattern every 45 seconds that opened the KDE icon cache file of the user for writing followed by an immediate close of the file again. This led to a necessary physical write to the hard disk as the file metadata (specifically, the modification time) had changed. The final fix was to prevent those unnecessary calls when no updates to the icons had occurred.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="BLTK"></a>2.4. Battery Life Tool Kit</h2>
          </div>
        </div>
      </div>
      <div class="para">
         Red Hat Enterprise Linux 6 introduces the <span class="application"><strong>Battery Life Tool Kit</strong></span> (<acronym class="acronym">BLTK</acronym>), a test suite that simulates and analyzes battery life and performance. <acronym class="acronym">BLTK</acronym> achieves this by performing sets of tasks that simulate specific user groups and reporting on the results. Although developed specifically to test notebook performance, <acronym class="acronym">BLTK</acronym> can also report on the performance of desktop computers when started with the <code class="option">-a</code>.
      </div>
      <div class="para">
         BLTK allows you to generate very reproducible workloads that are comparable to real use of a machine. For example, the <code class="literal">office</code> workload writes a text, corrects things in it, and does the same for a spreadsheet. Running BLTK combined with <span class="application"><strong>PowerTOP</strong></span> or any of the other auditing or analysis tool allows you to test if the optimizations you performed have an effect when the machine is actively in use instead of only idling. Because you can run the exact same workload multiple times for different settings, you can compare results for different settings.
      </div>
      <div class="para">
         Install <acronym class="acronym">BLTK</acronym> with the command:
      </div>
      <pre class="screen">
        <code class="command">yum install bltk</code>
      </pre>
      <div class="para">
         Run <acronym class="acronym">BLTK</acronym> with the command:
      </div>
      <pre class="screen">
        <code class="command">bltk <em class="replaceable"><code>workload</code></em><em class="replaceable"><code>options</code></em></code>
      </pre>
      <div class="para">
         For example, to run the <code class="literal">idle</code> workload for 120 seconds:
      </div>
      <pre class="screen">
        <code class="command">bltk -I -T 120</code>
      </pre>
      <div class="para">
         The workloads available by default are:
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="option">-I</code>, </span><span class="term"><code class="option">--idle</code></span></dt>
          <dd>
          <div class="para">
             system is idle, to use as a baseline for comparison with other workloads
          </div>
          </dd>
          <dt><span class="term"><code class="option">-R</code>, </span><span class="term"><code class="option">--reader</code></span></dt>
          <dd>
          <div class="para">
             simulates reading documents (by default, with <span class="application"><strong>Firefox</strong></span>)
          </div>
          </dd>
          <dt><span class="term"><code class="option">-P</code>, </span><span class="term"><code class="option">--player</code></span></dt>
          <dd>
          <div class="para">
             simulates watching multimedia files from a CD or DVD drive (by default, with <span class="application"><strong>mplayer</strong></span>)
          </div>
          </dd>
          <dt><span class="term"><code class="option">-O</code>, </span><span class="term"><code class="option">--office</code></span></dt>
          <dd>
          <div class="para">
             simulates editing documents with the <span class="application"><strong>OpenOffice.org</strong></span> suite
          </div>
          </dd>
        </dl>
      </div>
      <div class="para">
         Other options allow you to specify:
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="option">-a</code>, </span><span class="term"><code class="option">--ac-ignore</code></span></dt>
          <dd>
          <div class="para">
             ignore whether AC power is available (necessary for desktop use)
          </div>
          </dd>
          <dt><span class="term"><code class="option">-T <em class="replaceable"><code>number_of_seconds</code></em></code>, </span><span class="term"><code class="option">--time <em class="replaceable"><code>number_of_seconds</code></em></code></span></dt>
          <dd>
          <div class="para">
             the time (in seconds) over which to run the test; use this option with the <code class="literal">idle</code> workload
          </div>
          </dd>
          <dt><span class="term"><code class="option">-F <em class="replaceable"><code>filename</code></em></code>, </span><span class="term"><code class="option">--file <em class="replaceable"><code>filename</code></em></code></span></dt>
          <dd>
          <div class="para">
             specifies a file to be used by a particular workload, for example, a file for the <code class="literal">player</code> workload to play instead of accessing the CD or DVD drive
          </div>
          </dd>
          <dt><span class="term"><code class="option">-W <em class="replaceable"><code>application</code></em></code>, </span><span class="term"><code class="option">--prog <em class="replaceable"><code>application</code></em></code></span></dt>
          <dd>
          <div class="para">
             specifies an application to be used by a particular workload, for example, a browser other than <span class="application"><strong>Firefox</strong></span> for the <code class="literal">reader</code> workload
          </div>
          </dd>
        </dl>
      </div>
      <div class="para">
        <acronym class="acronym">BLTK</acronym> supports a large number of more specialized options. For details, refer to the <code class="literal">bltk</code> man page.
      </div>
      <div class="para">
        <acronym class="acronym">BLTK</acronym> saves the results that it generates in a directory specified in the <code class="filename">/etc/bltk.conf</code> configuration file ÃÂ¢ÃÂÃÂ by default, <code class="filename">~/.bltk/<em class="replaceable"><code>workload</code></em>.results.<em class="replaceable"><code>number</code></em>/</code>. For example, the <code class="filename">~/.bltk/reader.results.002/</code> directory holds the results of the third test with the <code class="literal">reader</code> workload (the first test is not numbered). The results are spread across several text files. To condense these results into a format that is easy to read, run:
      </div>
      <pre class="screen">
        <code class="command">bltk_report <em class="replaceable"><code>path_to_results_directory</code></em></code>
      </pre>
      <div class="para">
         The results now appear in a text file named <code class="filename">Report</code> in the results directory. To view the results in a terminal emulator instead, use the <code class="option">-o</code> option:
      </div>
      <pre class="screen">
        <code class="command">bltk_report -o <em class="replaceable"><code>path_to_results_directory</code></em></code>
      </pre>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Tuned"></a>2.5. Tuned and ktune</h2>
          </div>
        </div>
      </div>
      <div class="para">
        <span class="application"><strong>Tuned</strong></span> is a daemon that monitors the use of system components and dynamically tunes system settings based on that monitoring information. Dynamic tuning accounts for the way that various system components are used differently throughout the uptime for any given system. For example, the hard drive is used heavily during startup and login, but is barely used later when a user might mainly work with applications like OpenOffice or email clients. Similarly, the CPU and network devices are used differently at different times. <span class="application"><strong>Tuned</strong></span> monitors the activity of these components and reacts to changes in their use.
      </div>
      <div class="para">
         As a practical example, consider a typical office workstation. Most of the time, the Ethernet network interface will be very inactive. Only a few emails will go in and out every once in a while or some web pages might be loaded. For those kinds of loads, the network interface doesn't have to run at full speed all the time, as it does by default. <span class="application"><strong>Tuned</strong></span> has a monitoring and tuning plugin for network devices that can detect that low activity and then automatically lower the speed of that interface, typically resulting in lower power usage. If activity on the interface increases drastically for a longer period of time, for example because a DVD image is being downloaded or an email with a large attachment is opened, <span class="application"><strong>tuned</strong></span> detects this and sets the interface speed to maximum to offer the best performance while the activity level is so high. This principle is used for the other plugins for CPU and hard disks as well.
      </div>
      <div class="para">
         Network devices are not configured to behave this way by default because speed changes can take several seconds to take effect and therefore directly and visibly impact the user experience. Similar considerations apply for the CPU and hard drive tuning plugins. When a hard drive has been spun down, it can take several seconds for it to spin up again which results in an observed lack of responsiveness of the system during that period. The latency side effect is smallest for the CPU plugin, but it is still at least measurable, though hardly noticeable by a user.
      </div>
      <div class="para">
         Alongside of <span class="application"><strong>tuned</strong></span> we now also offer <span class="application"><strong>ktune</strong></span>. <span class="application"><strong>Ktune</strong></span> was introduced in Red Hat Enterprise Linux 5.3 as a framework and service to optimize the performance of a machine for a specific use cases. Since then, <span class="application"><strong>ktune</strong></span> has improved to such a degree that we now use it as the static part of our general tuning framework. It is mainly used in the different predefined profiles described in <a class="xref" href="#tuned-adm">Section 2.5.2, “Tuned-adm”</a>.
      </div>
      <div class="para">
         Install the <span class="package">tuned</span> package and its associated <span class="application"><strong>systemtap</strong></span> scripts with the command:
      </div>
      <pre class="screen">
        <code class="command">yum install tuned</code>
      </pre>
      <div class="para">
         Installing the <span class="package">tuned</span> package also sets up a sample configuration file at <code class="filename">/etc/tuned.conf</code> and activates the default profile.
      </div>
      <div class="para">
         Start <span class="application"><strong>tuned</strong></span> by running:
      </div>
      <pre class="screen">
        <code class="command">service tuned start</code>
      </pre>
      <div class="para">
         To start <span class="application"><strong>tuned</strong></span> every time the machine boots, run:
      </div>
      <pre class="screen">
        <code class="command">chkconfig tuned on</code>
      </pre>
      <div class="para">
        <span class="application"><strong>Tuned</strong></span> itself has additional options that you can use when you run it manually. The available options are:
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="option">-d</code>, </span><span class="term"><code class="option">--daemon</code></span></dt>
          <dd>
          <div class="para">
             start <span class="application"><strong>tuned</strong></span> as a daemon instead of in the foreground.
          </div>
          </dd>
          <dt><span class="term"><code class="option">-c</code>, </span><span class="term"><code class="option">--conffile</code></span></dt>
          <dd>
          <div class="para">
             use a configuration file with the specified name and path, for example, <code class="literal">--conffile=/etc/tuned2.conf</code>. The default is <code class="filename">/etc/tuned.conf</code>.
          </div>
          </dd>
          <dt><span class="term"><code class="option">-D</code>, </span><span class="term"><code class="option">--debug</code></span></dt>
          <dd>
          <div class="para">
             use the highest level of logging.
          </div>
          </dd>
        </dl>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="The_tuned.conf_file"></a>2.5.1. The <code class="filename">tuned.conf</code> file</h3>
            </div>
          </div>
        </div>
        <div class="para">
           The <code class="filename">tuned.conf</code> file contains configuration settings for <span class="application"><strong>tuned</strong></span>. By default, it is located at <code class="filename">/etc/tuned.conf</code>, but you can specify a different name and location by starting <span class="application"><strong>tuned</strong></span> with the <code class="option">--conffile</code> option.
        </div>
        <div class="para">
           The config file must always contain a <code class="literal">[main]</code> section that defines the general parameters for <span class="application"><strong>tuned</strong></span>. The file then contains a section for each plugin.
        </div>
        <div class="para">
           The <code class="literal">[main]</code> section contains the following options:
        </div>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="option">interval</code></span></dt>
            <dd>
            <div class="para">
               the interval at which <span class="application"><strong>tuned</strong></span> should monitor and tune the system, in seconds. The default value is <code class="literal">10</code>.
            </div>
            </dd>
            <dt><span class="term"><code class="option">verbose</code></span></dt>
            <dd>
            <div class="para">
               specifies whether output should be verbose. The default value is <code class="literal">False</code>.
            </div>
            </dd>
            <dt><span class="term"><code class="option">logging</code></span></dt>
            <dd>
            <div class="para">
               specifies the minimum priority of messages to be logged. In descending order, allowable values are: <code class="literal">critical</code>, <code class="literal">error</code>, <code class="literal">warning</code>, <code class="literal">info</code>, and <code class="literal">debug</code>. The default value is <code class="literal">info</code>.
            </div>
            </dd>
            <dt><span class="term"><code class="option">logging_disable</code></span></dt>
            <dd>
            <div class="para">
               specifies the maximum priority of messages to be logged; any messages with this priority or lower will not be logged. In descending order, allowable values are: <code class="literal">critical</code>, <code class="literal">error</code>, <code class="literal">warning</code>, <code class="literal">info</code>, and <code class="literal">debug</code>. The value <code class="literal">notset</code> disables this option.
            </div>
            </dd>
          </dl>
        </div>
        <div class="para">
           Each plugin has its own section, specified with the name of the plugin in square brackets; for example: <code class="literal">[CPUTuning]</code>. Each plugin can have its own options, but the following apply to all plugins:
        </div>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="option">enabled</code></span></dt>
            <dd>
            <div class="para">
               specifies whether the plugin is enabled or not. The default value is <code class="literal">True</code>.
            </div>
            </dd>
            <dt><span class="term"><code class="option">verbose</code></span></dt>
            <dd>
            <div class="para">
               specifies whether output should be verbose. If not set for this plugin, the value is inherited from <code class="literal">[main]</code>.
            </div>
            </dd>
            <dt><span class="term"><code class="option">logging</code></span></dt>
            <dd>
            <div class="para">
               specifies the minimum priority of messages to be logged. If not set for this plugin, the value is inherited from <code class="literal">[main]</code>.
            </div>
            </dd>
          </dl>
        </div>
        <div class="para">
           A sample config file follows:
        </div>
        <pre class="programlisting">
          [main] interval=10 pidfile=/var/run/tuned.pid logging=info logging_disable=notset # Disk monitoring section [DiskMonitor] enabled=True logging=debug # Disk tuning section [DiskTuning] enabled=True hdparm=False alpm=False logging=debug # Net monitoring section [NetMonitor] enabled=True logging=debug # Net tuning section [NetTuning] enabled=True logging=debug # CPU monitoring section [CPUMonitor] # Enabled or disable the plugin. Default is True. Any other value # disables it. enabled=True # CPU tuning section [CPUTuning] # Enabled or disable the plugin. Default is True. Any other value # disables it. enabled=True
        </pre>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="tuned-adm"></a>2.5.2. Tuned-adm</h3>
            </div>
          </div>
        </div>
        <div class="para">
           Often, a detailed audit and analysis of a system can be very time consuming and might not be worth the few extra watts you might be able to save by doing so. Previously, the only alternative was simply to use the defaults. Therefore, Red Hat Enterprise Linux 6 includes separate profiles for specific use cases as an alternative between those two extremes, together with the <span class="application"><strong>tuned-adm</strong></span> tool that allows you to switch between these profiles easily at the command line. Red Hat Enterprise Linux 6 includes a number of predefined profiles for typical use cases that you can simply select and activate with the <code class="command">tuned-adm</code> command, but you can also create, modify or delete profiles yourself.
        </div>
        <div class="para">
           To list all available profiles and identify the current active profile, run:
        </div>
        <pre class="screen">
          <code class="command">tuned-adm list</code>
        </pre>
        <div class="para">
           To only display the currently active profile, run:
        </div>
        <pre class="screen">
          <code class="command">tuned-adm active</code>
        </pre>
        <div class="para">
           To switch to one of the available profiles, run:
        </div>
        <pre class="screen">
          <code class="command">tuned-adm profile <em class="replaceable"><code>profile_name</code></em></code>
        </pre>
        <div class="para">
           for example:
        </div>
        <pre class="screen">
          <code class="command">tuned-adm profile server-powersave</code>
        </pre>
        <div class="para">
           To disable all tuning:
        </div>
        <pre class="screen">
          <code class="command">tuned-adm off</code>
        </pre>
        <div class="para">
           When you first install <span class="application"><strong>tuned</strong></span>, the <code class="literal">default</code> profile will be active. Red Hat Enterprise Linux 6 also includes the following predefined profiles:
        </div>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term">default</span></dt>
            <dd>
            <div class="para">
               the default power-saving profile. It has the lowest impact on power saving of the available profiles and only enables CPU and disk plugins of <span class="application"><strong>tuned</strong></span>.
            </div>
            </dd>
            <dt><span class="term">desktop-powersave</span></dt>
            <dd>
            <div class="para">
               a power-saving profile directed at desktop systems. Enables ALPM power saving for SATA host adapters (refer to <a class="xref" href="#ALPM">Section 3.6, “Aggressive Link Power Management”</a>) as well as the CPU, Ethernet, and disk plugins of <span class="application"><strong>tuned</strong></span>.
            </div>
            </dd>
            <dt><span class="term">server-powersave</span></dt>
            <dd>
            <div class="para">
               a power-saving profile directed at server systems. Enables ALPM powersaving for SATA host adapters, disables CD-ROM polling through <span class="application"><strong>HAL</strong></span> (refer to the <span class="citerefentry"><span class="refentrytitle">hal-disable-polling</span>
              </span> man page) and activates the CPU and disk plugins of <span class="application"><strong>tuned</strong></span>.
            </div>
            </dd>
            <dt><span class="term">laptop-ac-powersave</span></dt>
            <dd>
            <div class="para">
               a medium-impact power-saving profile directed at laptops running on AC. Enables ALPM powersaving for SATA host adapters, WiFi power saving, as well as the CPU, Ethernet and disk plugins of <span class="application"><strong>tuned</strong></span>.
            </div>
            </dd>
            <dt><span class="term">laptop-battery-powersave</span></dt>
            <dd>
            <div class="para">
               a high-impact power-saving profile directed at laptops running on battery. It activates all power saving mechanisms from the previous profiles plus it enables the multi-core power-savings scheduler for low wakeup systems and makes sure that the ondemand governor is active and that AC97 audio power-saving is enabled. You can use this profile to save the maximum amount of power on any kind of system, not only laptops on battery power. The tradeoff for this profile is a noticeable impact on performance, specifically latency of disk and network I/O.
            </div>
            </dd>
            <dt><span class="term">throughput-performance</span></dt>
            <dd>
            <div class="para">
               a server profile for typical throughput performance tuning. It disables <span class="application"><strong>tuned</strong></span> and <span class="application"><strong>ktune</strong></span> power saving mechanisms, enables <span class="application"><strong>sysctl</strong></span> settings that improve the throughput performance of your disk and network I/O, and switches to the <span class="application"><strong>deadline scheduler</strong></span>.
            </div>
            </dd>
            <dt><span class="term">latency-performance</span></dt>
            <dd>
            <div class="para">
               a server profile for typical latency performance tuning. it disables <span class="application"><strong>tuned</strong></span> and <span class="application"><strong>ktune</strong></span> power saving mechanisms and enables <span class="application"><strong>sysctl</strong></span> settings that improve the latency performance of your network I/O.
            </div>
            </dd>
          </dl>
        </div>
        <div class="para">
           All the profiles are stored in separate subdirectories under <code class="filename">/etc/tune-profiles</code>. So <code class="filename">/etc/tune-profiles/desktop-powersave</code> contains all the necessary files and settings for that profile. Each of these directories contains up to four files:
        </div>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="filename">tuned.conf</code></span></dt>
            <dd>
            <div class="para">
               the configuration for the tuned service to be active for this profile.
            </div>
            </dd>
            <dt><span class="term"><code class="filename">sysctl.ktune</code></span></dt>
            <dd>
            <div class="para">
               the <span class="application"><strong>sysctl</strong></span> settings used by <span class="application"><strong>ktune</strong></span>. The format is identical to the <code class="filename">/etc/sysconfig/sysctl</code> file (refer to the <span class="citerefentry"><span class="refentrytitle">sysctl</span>
              </span> and <span class="citerefentry"><span class="refentrytitle">sysctl.conf</span>
              </span> man pages).
            </div>
            </dd>
            <dt><span class="term"><code class="filename">ktune.sysconfig</code></span></dt>
            <dd>
            <div class="para">
               the configuration file of ktune itself, typically <code class="filename">/etc/sysconfig/ktune</code>.
            </div>
            </dd>
            <dt><span class="term"><code class="filename">ktune.sh</code></span></dt>
            <dd>
            <div class="para">
               an <span class="application"><strong>init</strong></span>-style shell script used by the <span class="application"><strong>ktune</strong></span> service which can run specific commands during system startup to tune the system.
            </div>
            </dd>
          </dl>
        </div>
        <div class="para">
           The easiest way to start a new profile is to copy an existing one. The <code class="literal">laptop-battery-powersave</code> profile contains a very rich set of tunings already and is therefore a useful starting point. Simply copy the whole directory to the new profile name like this:
        </div>
        <pre class="screen">
          <code class="command">cp -a /etc/tune-profiles/laptop-battery-powersave/ /etc/tune-profiles/myprofile</code>
        </pre>
        <div class="para">
           Modify any of the files in the new profile to match your personal requirements. For example, if you require the detection of CD changes you could disable that optimization by commenting out the appropriate line in the ktune.sh script:
        </div>
        <pre class="programlisting">
          # Disable HAL polling of CDROMS # for i in /dev/scd*; do hal-disable-polling --device $i; done /dev/null 2&amp;1
        </pre>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="devicekit-power"></a>2.6. DeviceKit-power and devkit-power</h2>
          </div>
        </div>
      </div>
      <div class="para">
         In Red Hat Enterprise Linux 6 <span class="application"><strong>DeviceKit-power</strong></span> assumes the power management functions that were part of <span class="application"><strong>HAL</strong></span> and some of the functions that were part of <span class="application"><strong>GNOME Power Manager</strong></span> in previous releases of Red Hat Enterprise Linux (refer also to <a class="xref" href="#gnome-power-manager">Section 2.7, “GNOME Power Manager”</a>. <span class="application"><strong>DeviceKit-power</strong></span> provides a daemon, an API, and a set of command-line tools. Each power source on the system is represented as a device, whether it is a physical device or not. For example, a laptop battery and an AC power source are both represented as devices.
      </div>
      <div class="para">
         You can access the command-line tools with the <code class="command">devkit-power</code> command and the following options:
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="option">--enumerate</code>, </span><span class="term"><code class="option">-e</code></span></dt>
          <dd>
          <div class="para">
             displays an object path for each power devices on the system, for example:
          </div>
          <pre class="screen">
            <code class="computeroutput">/org/freedesktop/DeviceKit/power/devices/line_power_AC</code>
            <code class="computeroutput">/org/freedesktop/UPower/DeviceKit/power/battery_BAT0</code>
          </pre>
          </dd>
          <dt><span class="term"><code class="option">--dump</code>, </span><span class="term"><code class="option">-d</code></span></dt>
          <dd>
          <div class="para">
             displays the parameters for all power devices on the system.
          </div>
          </dd>
          <dt><span class="term"><code class="option">--wakeups</code>, </span><span class="term"><code class="option">-w</code></span></dt>
          <dd>
          <div class="para">
             displays the CPU wakeups on the system.
          </div>
          </dd>
          <dt><span class="term"><code class="option">--monitor</code>, </span><span class="term"><code class="option">-m</code></span></dt>
          <dd>
          <div class="para">
             monitors the system for changes to power devices, for example, the connection or disconnection of a source of AC power, or the depletion of a battery. Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> to stop monitoring the system.
          </div>
          </dd>
          <dt><span class="term"><code class="option">--monitor-detail</code></span></dt>
          <dd>
          <div class="para">
             monitors the system for changes to power devices, for example, the connection or disconnection of a source of AC power, or the depletion of a battery. The <code class="option">--monitor-detail</code> option presents more detail than the <code class="option">--monitor</code> option. Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> to stop monitoring the system.
          </div>
          </dd>
          <dt><span class="term"><code class="option">--show-info <em class="replaceable"><code>object_path</code></em></code>, </span><span class="term"><code class="option">-i <em class="replaceable"><code>object_path</code></em></code></span></dt>
          <dd>
          <div class="para">
             displays all information available for a particular object path. For example, to obtain information about a battery on your system represented by the object path <code class="systemitem">/org/freedesktop/UPower/DeviceKit/power/battery_BAT0</code>, run:
          </div>
          <pre class="screen">
            <code class="command">devkit-power -i /org/freedesktop/UPower/DeviceKit/power/battery_BAT0</code>
          </pre>
          </dd>
        </dl>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="gnome-power-manager"></a>2.7. GNOME Power Manager</h2>
          </div>
        </div>
      </div>
      <div class="para">
        <span class="application"><strong>GNOME Power Manager</strong></span> is a daemon that is installed as part of the GNOME desktop. Much of the power-management functionality that <span class="application"><strong>GNOME Power Manager</strong></span> provided in earlier versions of Red Hat Enterprise Linux has become part of <span class="application"><strong>DeviceKit-power</strong></span> in Red Hat Enterprise Linux6 (refer to <a class="xref" href="#devicekit-power">Section 2.6, “DeviceKit-power and devkit-power”</a>. However, <span class="application"><strong>GNOME Power Manager</strong></span> remains a front end for that functionality. Through an applet in the system tray, <span class="application"><strong>GNOME Power Manager</strong></span> notifies you of changes in your system's power status; for example, a change from battery to AC power. It also reports battery status, and warns you when battery power is low.
      </div>
      <div class="para">
        <span class="application"><strong>GNOME Power Manager</strong></span> also allows you to configure some basic power management settings. To access these settings, click the <span class="application"><strong>GNOME Power Manager</strong></span> icon in the system tray, then click <span class="guimenuitem"><strong>Preferences</strong></span>
      </div>
      <div class="para">
         The <span class="guilabel"><strong>Power Management Preferences</strong></span> screen contains three tabs:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
            <span class="guilabel"><strong>On AC Power</strong></span>
          </div>
          </li>
          <li class="listitem">
          <div class="para">
            <span class="guilabel"><strong>On Battery Power</strong></span>
          </div>
          </li>
          <li class="listitem">
          <div class="para">
            <span class="guilabel"><strong>General</strong></span>
          </div>
          </li>
        </ul>
      </div>
      <div class="para">
         Use the <span class="guilabel"><strong>On AC Power</strong></span> and <span class="guilabel"><strong>On Battery Power</strong></span> tabs to specify how much time must pass before the display is turned off on an inactive system, how much time must pass before an inactive system is put to sleep, and whether the system should spin down hard disks when not in use. The <span class="guilabel"><strong>On Battery Power</strong></span> tab also allows you to set the display brightness and to choose a behavior for a system with a critically low battery. For example, by default, <span class="application"><strong>GNOME Power Manager</strong></span> makes a system hibernate when its battery level reaches a critically low level. Use the <span class="guilabel"><strong>General</strong></span> tab to set behaviours for the (physical) power button and suspend button on your system, and to specify the circumstances under which the <span class="application"><strong>GNOME Power Manager</strong></span> icon should appear in the system tray.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Other_auditing"></a>2.8. Other means for auditing</h2>
          </div>
        </div>
      </div>
      <div class="para">
         Red Hat Enterprise Linux 6 offers quite a few more tools with which to perform system auditing and analysis. Most of them can be used as a supplementary sources of information in case you want to verify what you have discovered already or in case you need more in-depth information on certain parts. Many of these tools are used for performance tuning as well. They include:
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="application"><strong>vmstat</strong></span></span></dt>
          <dd>
          <div class="para">
            <span class="application"><strong>vmstat</strong></span> gives you detailed information about processes, memory, paging, block I/O, traps, and CPU activity. Use it to take a closer look at what the system overall does and where it is busy.
          </div>
          </dd>
          <dt><span class="term"><span class="application"><strong>iostat</strong></span></span></dt>
          <dd>
          <div class="para">
            <span class="application"><strong>iostat</strong></span> is similar to <span class="application"><strong>vmstat</strong></span>, but only for I/O on block devices. It also provides more verbose output and statistics.
          </div>
          </dd>
          <dt><span class="term"><span class="application"><strong>blktrace</strong></span></span></dt>
          <dd>
          <div class="para">
            <span class="application"><strong>blktrace</strong></span> is a very detailed block I/O trace program. It breaks down information to single blocks associated with applications. It is very useful in combination with <span class="application"><strong>diskdevstat</strong></span>.
          </div>
          </dd>
        </dl>
      </div>
    </div>
  </div>
  <div class="chapter">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a id="Core_Infrastructure"></a>Core Infrastructure and Mechanics</h1>
        </div>
      </div>
    </div>
    <div class="toc">
      <dl class="toc">
        <dt><span class="section"><a href="#C-States">3.1. CPU Idle States</a></span></dt>
        <dt><span class="section"><a href="#cpufreq_governors">3.2. Using <code class="command">CPUfreq</code> Governors</a></span></dt>
        <dd>
        <dl>
          <dt><span class="section"><a href="#governor_types">3.2.1. CPUfreq Governor Types</a></span></dt>
          <dt><span class="section"><a href="#cpufreq_setup">3.2.2. CPUfreq Setup</a></span></dt>
          <dt><span class="section"><a href="#tuning_cpufreq_policy_and_speed">3.2.3. Tuning CPUfreq Policy and Speed</a></span></dt>
        </dl>
        </dd>
        <dt><span class="section"><a href="#Suspend_and_Resume">3.3. Suspend and Resume</a></span></dt>
        <dt><span class="section"><a href="#Tickless-kernel">3.4. Tickless Kernel</a></span></dt>
        <dt><span class="section"><a href="#ASPM">3.5. Active-State Power Management</a></span></dt>
        <dt><span class="section"><a href="#ALPM">3.6. Aggressive Link Power Management</a></span></dt>
        <dt><span class="section"><a href="#Relatime">3.7. Relatime Drive Access Optimization</a></span></dt>
        <dt><span class="section"><a href="#Power_Capping">3.8. Power Capping</a></span></dt>
        <dt><span class="section"><a href="#Enhanced_Graphics_Power_Management">3.9. Enhanced Graphics Power Management</a></span></dt>
        <dt><span class="section"><a href="#RFKill">3.10. RFKill</a></span></dt>
        <dt><span class="section"><a href="#Optimizations_in_User_Space">3.11. Optimizations in User Space</a></span></dt>
      </dl>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="C-States"></a>3.1. CPU Idle States</h2>
          </div>
        </div>
      </div>
      <div class="para">
         CPUs with the x86 architecture support various states in which parts of the CPU are deactivated or run at lower performance settings. These states, known as <em class="firstterm">C-states</em>, allow systems to save power by partially deactivating CPUs that are not in use. C-states are numbered from C0 upwards, with higher numbers representing decreased CPU functionality and greater power saving. C-States of a given number are broadly similar across processors, although the exact details of the specific feature sets of the state may vary between processor families. C-States 0â3 are defined as follows:
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term">C0</span></dt>
          <dd>
          <div class="para">
             the operating or running state. In this state, the CPU is working and not idle at all.
          </div>
          </dd>
          <dt><span class="term">C1, </span><span class="term">Halt</span></dt>
          <dd>
          <div class="para">
             a state where the processor is not executing any instructions but is typically not in a lower power state. The CPU can continue processing with practically no delay. All processors offering C-States need to support this state. Pentium4 processors support an enhanced C1 state called C1E that actually is a state for lower power consumption.
          </div>
          </dd>
          <dt><span class="term">C2, </span><span class="term">Stop-Clock</span></dt>
          <dd>
          <div class="para">
             a state where the the clock is frozen for this processor but it keeps the complete state for its registers and caches, so after starting the clock again it can immediately start processing again. This is an optional state.
          </div>
          </dd>
          <dt><span class="term">C3, </span><span class="term">Sleep</span></dt>
          <dd>
          <div class="para">
             a state where the processor really goes to sleep and doesn't need to keep it's cache up to date. Waking up from this state takes considerably longer than from C2 due to this. Again this is an optional state.
          </div>
          </dd>
        </dl>
      </div>
      <div class="para">
         Recent Intel CPUs with the "Nehalem" microarchitecture feature a new C-State, C6, which can reduce the voltage supply of a CPU to zero, but typically reduces power consumption by between 80% and 90%. The kernel in Red Hat Enterprise Linux6 includes optimizations for this new C-State.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="cpufreq_governors"></a>3.2. Using <code class="command">CPUfreq</code> Governors</h2>
          </div>
        </div>
      </div>
      <a id="idm236142082800" class="indexterm"></a>
      <a id="idm236142080544" class="indexterm"></a>
      <a id="idm236142079136" class="indexterm"></a>
      <a id="idm236142077728" class="indexterm"></a>
      <a id="idm236142075808" class="indexterm"></a>
      <a id="idm236142073888" class="indexterm"></a>
      <div class="para">
         One of the most effective ways to reduce power consumption and heat output on your system is to use CPUfreq. CPUfreq ÃÂ¢ÃÂÃÂ also referred to as CPU speed scaling ÃÂ¢ÃÂÃÂ allows the clock speed of the processor to be adjusted on the fly. This enables the system to run at a reduced clock speed to save power. The rules for shifting frequencies, whether to a faster or slower clock speed, and when to shift frequencies, are defined by the CPUfreq governor.
      </div>
      <div class="para">
         The governor defines the power characteristics of the system CPU, which in turn affects CPU performance. Each governor has its own unique behavior, purpose, and suitability in terms of workload. This section describes how to choose and configure a CPUfreq governor, the characteristics of each governor, and what kind of workload each governor is suitable for.
      </div>
      <div xml:lang="en-US" class="section" lang="en-US">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="governor_types"></a>3.2.1. CPUfreq Governor Types</h3>
            </div>
          </div>
        </div>
        <a id="idm236142068752" class="indexterm"></a>
        <a id="idm236142066336" class="indexterm"></a>
        <a id="idm236142064672" class="indexterm"></a>
        <a id="idm236142063104" class="indexterm"></a>
        <div class="para">
           This section lists and describes the different types of CPUfreq governors available in Red Hat Enterprise Linux 6.
        </div>
        <div class="formalpara">
          <div xmlns:d="http://docbook.org/ns/docbook" class="title">
            cpufreq_performance
          </div>
          <a id="idm236142059552" class="indexterm"></a>
          <a id="idm236142057664" class="indexterm"></a>
          <a id="idm236142055776" class="indexterm"></a>
          <a id="idm236142053856" class="indexterm"></a>
          <a id="idm236142051936" class="indexterm"></a>
          <a id="idm236142050016" class="indexterm"></a>
          The Performance governor forces the CPU to use the highest possible clock frequency. This frequency will be statically set, and will not change. As such, this particular governor offers <span class="emphasis"><em>no power saving benefit</em></span>. It is only suitable for hours of heavy workload, and even then only during times wherein the CPU is rarely (or never) idle.
        </div>
        <div class="formalpara">
          <div xmlns:d="http://docbook.org/ns/docbook" class="title">
            cpufreq_powersave
          </div>
          <a id="idm236142044608" class="indexterm"></a>
          <a id="idm236142042656" class="indexterm"></a>
          <a id="idm236142040736" class="indexterm"></a>
          <a id="idm236142038464" class="indexterm"></a>
          <a id="idm236142036512" class="indexterm"></a>
          <a id="idm236142034592" class="indexterm"></a>
          By contrast, the Powersave governor forces the CPU to use the lowest possible clock frequency. This frequency will be statically set, and will not change. As such, this particular governor offers maximum power savings, but at the cost of the <span class="emphasis"><em>lowest CPU performance</em></span>.
        </div>
        <div class="para">
           The term "powersave" can sometimes be deceiving, though, since (in principle) a slow CPU on full load consumes more power than a fast CPU that is not loaded. As such, while it may be advisable to set the CPU to use the Powersave governor during times of expected low activity, any unexpected high loads during that time can cause the system to actually consume more power.
        </div>
        <div class="para">
           The Powersave governor is, in simple terms, more of a "speed limiter" for the CPU than a "power saver". It is most useful in systems and environments where overheating can be a problem.
        </div>
        <div class="formalpara">
          <div xmlns:d="http://docbook.org/ns/docbook" class="title">
            cpufreq_ondemand
          </div>
          <a id="idm236142028256" class="indexterm"></a>
          <a id="idm236142026336" class="indexterm"></a>
          <a id="idm236142024416" class="indexterm"></a>
          <a id="idm236142022112" class="indexterm"></a>
          <a id="idm236142020160" class="indexterm"></a>
          <a id="idm236142018240" class="indexterm"></a>
          The Ondemand governor is a dynamic governor that allows the CPU to achieve maximum clock frequency when system load is high, and also minimum clock frequency when the system is idle. While this allows the system to adjust power consumption accordingly with respect to system load, it does so at the expense of <span class="emphasis"><em>latency between frequency switching</em></span>. As such, latency can offset any performance/power saving benefits offered by the Ondemand governor if the system switches between idle and heavy workloads too often.
        </div>
        <div class="para">
           For most systems, the Ondemand governor can provide the best compromise between heat emission, power consumption, performance, and manageability. When the system is only busy at specific times of the day, the Ondemand governor will automatically switch between maximum and minimum frequency depending on the load without any further intervention.
        </div>
        <div class="formalpara">
          <div xmlns:d="http://docbook.org/ns/docbook" class="title">
            cpufreq_userspace
          </div>
          <a id="idm236142011920" class="indexterm"></a>
          <a id="idm236142010000" class="indexterm"></a>
          <a id="idm236142008080" class="indexterm"></a>
          <a id="idm236142005776" class="indexterm"></a>
          <a id="idm236142003824" class="indexterm"></a>
          <a id="idm236142001904" class="indexterm"></a>
          The Userspace governor allows userspace programs (or any process running as root) to set the frequency. This governor is normally used in conjunction with the <code class="command">cpuspeed</code> daemon. Of all the governors, Userspace is the most customizable; and depending on how it is configured, it can offer the best balance between performance and consumption for your system.
        </div>
        <div class="formalpara">
          <div xmlns:d="http://docbook.org/ns/docbook" class="title">
            cpufreq_conservative
          </div>
          <a id="idm236141996944" class="indexterm"></a>
          <a id="idm236141995024" class="indexterm"></a>
          <a id="idm236141993104" class="indexterm"></a>
          <a id="idm236141990800" class="indexterm"></a>
          <a id="idm236141988848" class="indexterm"></a>
          <a id="idm236141986928" class="indexterm"></a>
          Like the Ondemand governor, the Conservative governor also adjusts the clock frequency according to usage (like the Ondemand governor). However, while the Ondemand governor does so in a more aggressive manner (that is from maximum to minimum and back), the Conservative governor switches between frequencies more gradually.
        </div>
        <div class="para">
           This means that the Conservative governor will adjust to a clock frequency that it deems fitting for the load, rather than simply choosing between maximum and minimum. While this can possibly provide significant savings in power consumption, it does so at an ever <span class="emphasis"><em>greater latency</em></span> than the Ondemand governor.
        </div>
        <div xmlns:d="http://docbook.org/ns/docbook" class="note">
          <div class="admonition_header">
            <p>
              <strong>Note</strong>
            </p>
          </div>
          <div class="admonition">
            <a id="idm236141981520" class="indexterm"></a>
            <a id="idm236141980080" class="indexterm"></a>
            <a id="idm236141978288" class="indexterm"></a>
            <a id="idm236141976848" class="indexterm"></a>
            <div class="para">
               You can enable a governor using <code class="command">cron</code> jobs. This allows you to automatically set specific governors during specific times of the day. As such, you can specify a low-frequency governor during idle times (for example after work hours) and return to a higher-frequency governor during hours of heavy workload.
            </div>
            <div class="para">
               For instructions on how to enable a specific governor, refer to <a class="xref" href="#enabling_a_cpufreq_governor">Procedure 3.2, “Enabling a CPUfreq Governor”</a> in <a class="xref" href="#cpufreq_setup">Section 3.2.2, “CPUfreq Setup”</a>.
            </div>
          </div>
        </div>
      </div>
      <div xml:lang="en-US" class="section" lang="en-US">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="cpufreq_setup"></a>3.2.2. CPUfreq Setup</h3>
            </div>
          </div>
        </div>
        <a id="idm236141971680" class="indexterm"></a>
        <a id="idm236141969808" class="indexterm"></a>
        <a id="idm236141968368" class="indexterm"></a>
        <div class="para">
           Before selecting and configuring a CPUfreq governor, you need to add the appropriate CPUfreq driver first.
        </div>
        <div xmlns:d="http://docbook.org/ns/docbook" class="procedure">
          <a id="idm236141965200"></a>
          <p class="title">
            <strong>Procedure 3.1. How to Add a CPUfreq Driver</strong>
          </p>
          <a id="idm236141963728" class="indexterm"></a><a id="idm236141961872" class="indexterm"></a><a id="idm236141959952" class="indexterm"></a>
          <ol class="1">
            <li class="step">
            <div class="para">
               Use the following command to view which CPUfreq drivers are available for your system:
            </div>
            <pre class="screen">
              <code class="command">ls /lib/modules/<em class="replaceable"><code>[kernel version]</code></em>/kernel/arch/<em class="replaceable"><code>[architecture]</code></em>/kernel/cpu/cpufreq/</code>
            </pre>
            </li>
            <li class="step">
            <div class="para">
               Use <code class="command">modprobe</code> to add the appropriate CPUfreq driver.
            </div>
            <pre class="screen">
              <code class="command">modprobe <em class="replaceable"><code>[CPUfreq driver]</code></em></code>
            </pre>
            <div class="para">
               When using the above command, be sure to remove the <code class="command">.ko</code> filename suffix.
            </div>
            <div class="important">
              <div class="admonition_header">
                <p>
                  <strong>Important</strong>
                </p>
              </div>
              <div class="admonition">
                <a id="idm236141950640" class="indexterm"></a>
                <a id="idm236141948688" class="indexterm"></a>
                <a id="idm236141946768" class="indexterm"></a>
                <a id="idm236141944592" class="indexterm"></a>
                <a id="idm236141942640" class="indexterm"></a>
                <a id="idm236141940720" class="indexterm"></a>
                <a id="idm236141938544" class="indexterm"></a>
                <a id="idm236141936592" class="indexterm"></a>
                <a id="idm236141934672" class="indexterm"></a>
                <div class="para">
                   When choosing an appropriate CPUfreq driver, always choose <code class="filename">acpi-cpufreq</code> over <code class="filename">p4-clockmod</code>. While using the <code class="filename">p4-clockmod</code> driver reduces the clock frequency of a CPU, it does not reduce the voltage. <code class="filename">acpi-cpufreq</code>, on the other hand, reduces voltage along with CPU clock frequency, allowing less power consumption and heat output for each unit reduction in performance.
                </div>
              </div>
            </div>
            </li>
            <li class="step">
            <div class="para">
               Once the CPUfreq driver is set up, you can view which governor the system is currently using with:
            </div>
            <pre class="screen">
              <code class="command">cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</code>
            </pre>
            </li>
          </ol>
        </div>
        <div class="para">
           You can also view which governors are available for use for a specific CPU using:
        </div>
        <pre class="screen">
          <code class="command">cat /sys/devices/system/cpu/<em class="replaceable"><code>[cpu ID]</code></em>/cpufreq/scaling_available_governors</code>
        </pre>
        <div class="para">
           Some CPUfreq governors may not be available for you to use. In this case, use <code class="command">modprobe</code> to add the necessary kernel modules that enable the specific CPUfreq governor you wish to use. These kernel modules are available in <code class="filename">/lib/modules/<em class="replaceable"><code>[kernel version]</code></em>/kernel/drivers/cpufreq/</code>.
        </div>
        <div xmlns:d="http://docbook.org/ns/docbook" class="procedure">
          <a id="enabling_a_cpufreq_governor"></a>
          <p class="title">
            <strong>Procedure 3.2. Enabling a CPUfreq Governor</strong>
          </p>
          <a id="idm236141922512" class="indexterm"></a><a id="idm236141920720" class="indexterm"></a><a id="idm236141918800" class="indexterm"></a><a id="idm236141916496" class="indexterm"></a><a id="idm236141914544" class="indexterm"></a><a id="idm236141912624" class="indexterm"></a><a id="idm236141910704" class="indexterm"></a><a id="idm236141908784" class="indexterm"></a><a id="idm236141906864" class="indexterm"></a>
          <ol class="1">
            <li class="step">
            <div class="para">
               If a specific governor is not listed as available for your CPU, use <code class="command">modprobe</code> to enable the governor you wish to use. For example, if the <code class="command">ondemand</code> governor is not available for your CPU, use the following command:
            </div>
            <pre class="screen">
              <code class="command">modprobe cpufreq_ondemand</code>
            </pre>
            </li>
            <li class="step">
            <div class="para">
               Once a governor is listed as available for your CPU, you can enable it using:
            </div>
            <pre class="screen">
              <code class="command">echo <em class="replaceable"><code>[governor]</code></em> /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</code>
            </pre>
            </li>
          </ol>
        </div>
      </div>
      <div xml:lang="en-US" class="section" lang="en-US">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="tuning_cpufreq_policy_and_speed"></a>3.2.3. Tuning CPUfreq Policy and Speed</h3>
            </div>
          </div>
        </div>
        <a id="idm236141899024" class="indexterm"></a>
        <a id="idm236141897200" class="indexterm"></a>
        <a id="idm236141895696" class="indexterm"></a>
        <a id="idm236141894288" class="indexterm"></a>
        <a id="idm236141892368" class="indexterm"></a>
        <a id="idm236141890448" class="indexterm"></a>
        <div class="para">
           Once you've chosen an appropriate CPUfreq governor, you can further tune the speed of each CPU using the tunables found in <code class="filename">/sys/devices/system/cpu/<em class="replaceable"><code>[cpu ID]</code></em>/cpufreq/</code>. These tunables are:
        </div>
        <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
          <ul>
            <li class="listitem">
            <div class="para">
              <code class="filename">cpuinfo_min_freq</code> Shows the CPU's available minimum operating frequency (in KHz).
            </div>
            <a id="idm236141884816" class="indexterm"></a>
            <a id="idm236141882928" class="indexterm"></a>
            <a id="idm236141881008" class="indexterm"></a>
            </li>
            <li class="listitem">
            <a id="idm236141878704" class="indexterm"></a>
            <a id="idm236141876784" class="indexterm"></a>
            <a id="idm236141874864" class="indexterm"></a>
            <div class="para">
              <code class="filename">cpuinfo_max_freq</code> Shows the CPU's available maximum operating frequency (in KHz).
            </div>
            </li>
            <li class="listitem">
            <a id="idm236141871536" class="indexterm"></a>
            <a id="idm236141869648" class="indexterm"></a>
            <a id="idm236141867728" class="indexterm"></a>
            <div class="para">
              <code class="filename">scaling_driver</code> Shows what CPUfreq driver is used to set the frequency on this CPU.
            </div>
            </li>
            <li class="listitem">
            <a id="idm236141864400" class="indexterm"></a>
            <a id="idm236141862512" class="indexterm"></a>
            <a id="idm236141860624" class="indexterm"></a>
            <div class="para">
              <code class="filename">scaling_available_governors</code> Shows the CPUfreq governors available in this kernel. If you wish to use a CPUfreq governor that is not listed in this file, refer to <a class="xref" href="#enabling_a_cpufreq_governor">Procedure 3.2, “Enabling a CPUfreq Governor”</a> in <a class="xref" href="#cpufreq_setup">Section 3.2.2, “CPUfreq Setup”</a> for instructions on how to do so.
            </div>
            </li>
            <li class="listitem">
            <a id="idm236141856272" class="indexterm"></a>
            <a id="idm236141854384" class="indexterm"></a>
            <a id="idm236141852464" class="indexterm"></a>
            <div class="para">
              <code class="filename">scaling_governor</code> Shows what CPUfreq governor is currently in use. To use a different governor, simply use <code class="command">echo <em class="replaceable"><code>[governor]</code></em> /sys/devices/system/cpu/<em class="replaceable"><code>[cpu ID]</code></em>/cpufreq/scaling_governor</code> (refer to <a class="xref" href="#enabling_a_cpufreq_governor">Procedure 3.2, “Enabling a CPUfreq Governor”</a> in <a class="xref" href="#cpufreq_setup">Section 3.2.2, “CPUfreq Setup”</a> for more information).
            </div>
            </li>
            <li class="listitem">
            <a id="idm236141846416" class="indexterm"></a>
            <a id="idm236141844528" class="indexterm"></a>
            <a id="idm236141842608" class="indexterm"></a>
            <div class="para">
              <code class="filename">cpuinfo_cur_freq</code> Shows the current speed of the CPU (in KHz).
            </div>
            </li>
            <li class="listitem">
            <a id="idm236141839280" class="indexterm"></a>
            <a id="idm236141837392" class="indexterm"></a>
            <a id="idm236141835504" class="indexterm"></a>
            <div class="para">
              <code class="filename">scaling_available_frequencies</code> Lists available frequencies for the CPU, in KHz.
            </div>
            </li>
            <li class="listitem">
            <a id="idm236141832064" class="indexterm"></a>
            <a id="idm236141830144" class="indexterm"></a>
            <a id="idm236141828224" class="indexterm"></a>
            <div class="para">
              <code class="filename">scaling_min_freq</code> and <code class="filename">scaling_max_freq</code> Sets the <em class="firstterm">policy limits</em> of the CPU, in KHz.
            </div>
            <div class="important">
              <div class="admonition_header">
                <p>
                  <strong>Important</strong>
                </p>
              </div>
              <div class="admonition">
                <a id="idm236141822976" class="indexterm"></a>
                <a id="idm236141821088" class="indexterm"></a>
                <a id="idm236141819168" class="indexterm"></a>
                <div class="para">
                   When setting policy limits, you should set <code class="filename">scaling_max_freq</code> before <code class="filename">scaling_min_freq</code>.
                </div>
              </div>
            </div>
            </li>
            <li class="listitem">
            <a id="idm236141815552" class="indexterm"></a>
            <a id="idm236141813696" class="indexterm"></a>
            <a id="idm236141811776" class="indexterm"></a>
            <div class="para">
              <code class="filename">affected_cpus</code> Lists CPUs that require frequency coordination software.
            </div>
            </li>
            <li class="listitem">
            <a id="idm236141808320" class="indexterm"></a>
            <a id="idm236141806432" class="indexterm"></a>
            <a id="idm236141804512" class="indexterm"></a>
            <div class="para">
              <code class="filename">scaling_setspeed</code> Used to change the clock speed of the CPU, in KHz. You can only set a speed within the policy limits of the CPU (as per <code class="filename">scaling_min_freq</code> and <code class="filename">scaling_max_freq</code>).
            </div>
            </li>
          </ul>
        </div>
        <div class="para">
           To view the current value of each tunable, use <code class="command">cat <em class="replaceable"><code>[tunable]</code></em></code>. For example, to view the current speed of cpu0 (in KHz), use:
        </div>
        <div class="para">
          <code class="command">cat /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_cur_freq</code>.
        </div>
        <div class="para">
           To change the value of each tunable, use <code class="command">echo <em class="replaceable"><code>[value]</code></em> /sys/devices/system/cpu/<em class="replaceable"><code>[cpu ID]</code></em>/cpufreq/<em class="replaceable"><code>[tunable]</code></em></code>. For example, to set the minimum clock speed of cpu0 to 360 KHz, use:
        </div>
        <div class="para">
          <code class="command">echo 360000 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq</code>
        </div>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Suspend_and_Resume"></a>3.3. Suspend and Resume</h2>
          </div>
        </div>
      </div>
      <div class="para">
         When a system is suspended, the kernel calls on drivers to store their states and then unloads them. When the system is resumed, it reloads these drivers, which attempt to reprogram their devices. The drivers' ability to accomplish this task determines whether the system can be resumed successfully.
      </div>
      <div class="para">
         Video drivers are particularly problematic in this regard, because the <em class="firstterm">Advanced Configuration and Power Interface</em> (ACPI) specification does not require system firmware to be able to reprogram video hardware. Therefore, unless video drivers are able to program hardware from a completely uninitialized state, they may prevent the system from resuming.
      </div>
      <div class="para">
         Red Hat Enterprise Linux 6 includes greater support for new graphics chipsets, which ensures that suspend and resume will work on a greater number of platforms. In particular, support for NVIDIA chipsets has been greatly improved; in particular for the GeForce8800 series.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Tickless-kernel"></a>3.4. Tickless Kernel</h2>
          </div>
        </div>
      </div>
      <div class="para">
         Previously, the Linux kernel periodically interrupted each CPU on a system at a predetermined frequency â 100Hz, 250Hz, or 1000Hz, depending on the platform. The kernel queried the CPU about the processes that it was executing, and used the results for process accounting and load balancing. Known as the <em class="firstterm">timer tick</em>, the kernel performed this interrupt regardless of the power state of the CPU. Therefore, even an idle CPU was responding to up to 1000 of these requests every second. On systems that implemented power saving measures for idle CPUs, the timer tick prevented the CPU from remaining idle long enough for the system to benefit from these power savings.
      </div>
      <div class="para">
         The kernel in Red Hat Enterprise Linux 6 runs <em class="firstterm">tickless</em>: that is, it replaces the old periodic timer interrupts with on-demand interrupts. Therefore, idle CPUs are allowed to remain idle until a new task is queued for processing, and CPUs that have entered lower power states can remain in these states longer.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="ASPM"></a>3.5. Active-State Power Management</h2>
          </div>
        </div>
      </div>
      <div class="para">
        <em class="firstterm">Active-State Power Management</em> (ASPM) saves power in the <em class="firstterm">Peripheral Component Interconnect Express</em> (PCI Express or PCIe) subsystem by setting a lower power state for PCIe links when the devices to which they connect are not in use. ASPM controls the power state at both ends of the link, and saves power in the link even when the device at the end of the link is in a fully powered-on state.
      </div>
      <div class="para">
         When ASPM is enabled, device latency increases because of the time required to transition the link between different power states. ASPM has three policies to determine power states:
      </div>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term">default</span></dt>
          <dd>
          <div class="para">
             sets PCIe link power states according to the defaults specified by the firmware on the system (for example, BIOS). This is the default state for ASPM.
          </div>
          </dd>
          <dt><span class="term">powersave</span></dt>
          <dd>
          <div class="para">
             sets ASPM to save power wherever possible, regardless of the cost to performance.
          </div>
          </dd>
          <dt><span class="term">performance</span></dt>
          <dd>
          <div class="para">
             disables ASPM to allow PCIe links to operate with maximum performance.
          </div>
          </dd>
        </dl>
      </div>
      <div class="para">
         ASPM policies are set in <code class="filename">/sys/module/pcie_aspm/parameters/policy</code>, but can also be specified at boot time with the <em class="parameter"><code>pcie_aspm</code></em> kernel parameter, where <code class="literal">pcie_aspm=off</code> disables ASPM and <code class="literal">pcie_aspm=force</code> enables ASPM, even on devices that do not support ASPM.
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="warning">
        <div class="admonition_header">
          <p>
            <strong>Warning ÃÂ¢ÃÂÃÂ <code class="literal">pcie_aspm=force</code> can cause systems to stop responding</strong>
          </p>
        </div>
        <div class="admonition">
          <div class="para">
             If <code class="literal">pcie_aspm=force</code> is set, hardware that does not support ASPM can cause the system to stop responding. Before setting <code class="literal">pcie_aspm=force</code>, ensure that all PCIe hardware on the system supports ASPM.
          </div>
        </div>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="ALPM"></a>3.6. Aggressive Link Power Management</h2>
          </div>
        </div>
      </div>
      <a id="idm236141766032" class="indexterm"></a>
      <a id="idm236141763664" class="indexterm"></a>
      <a id="idm236141761904" class="indexterm"></a>
      <div class="para">
        <em class="firstterm">Aggressive Link Power Management</em> (ALPM) is a power-saving technique that helps the disk save power by setting a SATA link to the disk to a low-power setting during idle time (that is when there is no I/O). ALPM automatically sets the SATA link back to an active power state once I/O requests are queued to that link.
      </div>
      <div class="para">
         Power savings introduced by ALPM come at the expense of disk latency. As such, you should only use ALPM if you expect the system to experience long periods of idle I/O time.
      </div>
      <a id="idm236141758656" class="indexterm"></a>
      <a id="idm236141756976" class="indexterm"></a>
      <a id="idm236141755520" class="indexterm"></a>
      <a id="idm236141753840" class="indexterm"></a>
      <a id="idm236141752352" class="indexterm"></a>
      <div class="para">
         ALPM is only available on SATA controllers that use the <em class="firstterm">Advanced Host Controller Interface</em> (AHCI). For more information about AHCI, refer to <code class="uri"><a class="uri" href="http://www.intel.com/technology/serialata/ahci.htm">http://www.intel.com/technology/serialata/ahci.htm</a></code>.
      </div>
      <div class="para">
         When available, ALPM is enabled by default. ALPM has three modes:
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          min_power
        </div>
        <a id="idm236141746992" class="indexterm"></a>
        <a id="idm236141745632" class="indexterm"></a>
        <a id="idm236141743824" class="indexterm"></a>
        <a id="idm236141742416" class="indexterm"></a>
        This mode sets the link to its lowest power state (SLUMBER) when there is no I/O on the disk. This mode is useful for times when an extended period of idle time is expected.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          medium_power
        </div>
        <a id="idm236141738512" class="indexterm"></a>
        <a id="idm236141737104" class="indexterm"></a>
        <a id="idm236141735296" class="indexterm"></a>
        <a id="idm236141733888" class="indexterm"></a>
        This mode sets the link to the second lowest power state (PARTIAL) when there is no I/O on the disk. This mode is designed to allow transitions in link power states (for example during times of intermittent heavy I/O and idle I/O) with as small impact on performance as possible.
      </div>
      <div class="para">
        <code class="command">medium_power</code> mode allows the link to transition between PARTIAL and fully-powered (that is "ACTIVE") states, depending on the load. Note that it is not possible to transition a link directly from PARTIAL to SLUMBER and back; in this case, either power state cannot transition to the other without transitioning through the ACTIVE state first.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          max_performance
        </div>
        <a id="idm236141728512" class="indexterm"></a>
        <a id="idm236141727200" class="indexterm"></a>
        ALPM is disabled; the link does not enter any low-power state when there is no I/O on the disk.
      </div>
      <div class="para">
         To check whether your SATA host adapters actually support ALPM you can check if the file <code class="filename">/sys/class/scsi_host/host*/link_power_management_policy</code> exists. To change the settings simply write the values described in this section to these files or display the files to check for the current setting.
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="important">
        <div class="admonition_header">
          <p>
            <strong>Important ÃÂ¢ÃÂÃÂ some settings disable hot plugging</strong>
          </p>
        </div>
        <div class="admonition">
          <a id="idm236141722672" class="indexterm"></a>
          <a id="idm236141721328" class="indexterm"></a>
          <div class="para">
             Setting ALPM to <code class="command">min_power</code> or <code class="command">medium_power</code> will automatically disable the "Hot Plug" feature.
          </div>
        </div>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Relatime"></a>3.7. Relatime Drive Access Optimization</h2>
          </div>
        </div>
      </div>
      <div class="para">
         The POSIX standard requires that operating systems maintain file system metadata that records when each file was last accessed. This timestamp is called <code class="systemitem">atime</code>, and maintaining it requires a constant series of write operations to storage. These writes keep storage devices and their links busy and powered up. Since few applications make use of the <code class="systemitem">atime</code> data, this storage device activity wastes power. Significantly, the write to storage would occur even if the file was not read from storage, but from cache. For some time, the Linux kernel has supported a <code class="option">noatime</code> option for <span class="application"><strong>mount</strong></span> and would not write <code class="systemitem">atime</code> data to file systems mounted with this option. However, simply turning off this feature is problematic because some applications rely on <code class="systemitem">atime</code> data and will fail if it is not available.
      </div>
      <div class="para">
         The kernel used in Red Hat Enterprise Linux 6 supports another alternative â <code class="option">relatime</code>. <code class="option">Relatime</code> maintains <code class="systemitem">atime</code> data, but not for each time that a file is accessed. With this option enabled, <code class="systemitem">atime</code> data is written to the disk only if the file has been modified since the <code class="systemitem">atime</code> data was last updated (<code class="systemitem">mtime</code>), or if the file was last accessed more than a certain length of time ago (by default, one day).
      </div>
      <div class="para">
         By default, all filesystems are now mounted with <code class="option">relatime</code> enabled. To suppress this feature across an entire system, use the boot parameter <em class="parameter"><code>default_relatime=0</code></em>. If <code class="option">relatime</code> is enabled on a system by default, you can suppress it for any particular file system by mounting that file system with the option <code class="option">norelatime</code>. Finally, to vary the default length of time before which the system will update a file's <code class="systemitem">atime</code> data, use the <em class="parameter"><code>relatime_interval=</code></em> boot parameter, specifying the period in seconds. The default value is <code class="literal">86400</code>.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Power_Capping"></a>3.8. Power Capping</h2>
          </div>
        </div>
      </div>
      <div class="para">
         Red Hat Enterprise Linux 6 supports the power capping features found in recent hardware, such as HP <em class="firstterm">Dynamic Power Capping</em> (DPC), and Intel Node Manager (NM) technology. Power capping allows administrators to limit the power consumed by servers, but it also allows managers to plan data centers more efficiently, because the risk of overloading existing power supplies is greatly diminished. Managers can place more servers within the same physical footprint and have confidence that if server power consumption is capped, the demand for power during heavy load will not exceed the power available.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          HP Dynamic Power Capping
        </div>
         Dynamic Power Capping is a feature available on select ProLiant and BladeSystem servers that allows system administrators to cap the power consumption of a server or a group of servers. The cap is a definitive limit that the server will not exceed, regardless of its current workload. The cap has no effect until the server reaches its power consumption limit. At that point, a management processor adjusts CPU P-states and clock throttling to limit the power consumed.
      </div>
      <div class="para">
         Dynamic Power Capping modifies CPU behavior independently of the operating system, however, HP's <em class="firstterm">integrated Lights-Out 2</em> (iLO2) firmware allows operating systems access to the management processor and therefore applications in user space can query the management processor. The kernel used in Red Hat Enterprise Linux 6 includes a driver for HP iLO and iLO2 firmware, which allows programs to query management processors at <code class="filename">/dev/hpilo/d<em class="replaceable"><code>X</code></em>ccb<em class="replaceable"><code>N</code></em></code>. The kernel also includes an extension of the <code class="systemitem">hwmon</code><code class="systemitem">sysfs</code> interface to support power capping features, and a <code class="systemitem">hwmon</code> driver for ACPI 4.0 power meters that use the <code class="systemitem">sysfs</code> interface. Together, these features allow the operating system and user-space tools to read the value configured for the power cap, together with the current power usage of the system.
      </div>
      <div class="para">
         For further details of HP Dynamic Power Capping, refer to <em class="citetitle">HP Power Capping and HP Dynamic Power Capping for ProLiant Servers</em>, available from <code class="uri"><a class="uri" href="http://h20000.www2.hp.com/bc/docs/support/SupportManual/c01549455/c01549455.pdf">http://h20000.www2.hp.com/bc/docs/support/SupportManual/c01549455/c01549455.pdf</a></code>
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Intel Node Manager
        </div>
         Intel Node Manager imposes a power cap on systems, using processor P-states and T-states to limit CPU performance and therefore power consumption. By setting a power management policy, administrators can configure systems to consume less power during times when system loads are low, for example, at night or on weekends.
      </div>
      <div class="para">
         Intel Node Manager adjusts CPU performance using <em class="firstterm">Operating System-directed configuration and Power Management</em> (OSPM) through the standard <em class="firstterm">Advanced Configuration and Power Interface</em>. When Intel Node Manager notifies the OSPM driver of changes to T-states, the driver makes corresponding changes to processor P-states. Similarly, when Intel Node Manager notifies the OSPM driver of changes to P-states, the driver changes T-states accordingly. These changes happen automatically and require no further input from the operating system. Administrators configure and monitor Intel Node Manager with <em class="firstterm">Intel Data Center Manager</em> (DCM) software.
      </div>
      <div class="para">
         For further details of Intel Node Manager, refer to <em class="citetitle">Node Manager â A Dynamic Approach To Managing Power In The Data Center</em>, available from <code class="uri"><a class="uri" href="http://communities.intel.com/docs/DOC-4766">http://communities.intel.com/docs/DOC-4766</a></code>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Enhanced_Graphics_Power_Management"></a>3.9. Enhanced Graphics Power Management</h2>
          </div>
        </div>
      </div>
      <div class="para">
         Red Hat Enterprise Linux 6 saves power on graphics and display devices by eliminating several sources of unnecessary consumption.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          LVDS reclocking
        </div>
        <em class="firstterm">Low-voltage differential signaling</em> (LVDS) is an system for carrying electronic signals over copper wire. One significant application of the system is to transmit pixel information to <em class="firstterm">liquid crystal display</em> (LCD) screens in notebook computers. All displays have a <em class="firstterm">refresh rate</em> â the rate at which they receive fresh data from a graphics controller and redraw the image on the screen. Typically, the screen receives fresh data sixty times per second (a frequency of 60Hz). When a screen and graphics controller are linked by LVDS, the LVDS system uses power on every refresh cycle. When idle, the refresh rate of many LCD screens can be dropped to 30Hz without any noticeable effect (unlike <em class="firstterm">cathode ray tube</em> (CRT) monitors, where a decrease in refresh rate produces a characteristic flicker). The driver for Intel graphics adapters built into the kernel used in Red Hat Enterprise Linux 6 performs this <em class="firstterm">downclocking</em> automatically, and saves around 0.5W when the screen is idle.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Enabling memory self-refresh
        </div>
        <em class="firstterm">Synchronous dynamic random access memory</em> (SDRAM) â as used for video memory in graphics adapters â is recharged thousands of times per second so that individual memory cells retain the data that is stored in them. Apart from its main function of managing data as it flows in and out of memory, the memory controller is normally responsible for initiating these refresh cycles. However, SDRAM also has a low-power <em class="firstterm">self-refresh</em> mode. In this mode, the memory uses an internal timer to generate its own refresh cycles, which allows the system to shut down the memory controller without endangering data currently held in memory. The kernel used in Red Hat Enterprise Linux 6 can trigger memory self-refresh in Intel graphics adapters when they are idle, which saves around 0.8W.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          GPU clock reduction
        </div>
         Typical graphical processing units (GPUs) contain internal clocks that govern various parts of their internal circuitry. The kernel used in Red Hat Enterprise Linux 6 can reduce the frequency of some of the internal clocks in Intel and ATI GPUs. Reducing the number of cycles that GPU components perform in a given time saves the power that they would have consumed in the cycles that they did not have to perform. The kernel automatically reduces the speed of these clocks when the GPU is idle, and increases it when GPU activity increases. Reducing GPU clock cycles can save up to 5W.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          GPU powerdown
        </div>
         The Intel and ATI graphics drivers in Red Hat Enterprise Linux 6 can detect when no monitor is attached to an adapter and therefore shut down the GPU completely. This feature is especially significant for servers which do not have monitors attached to them regularly.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="RFKill"></a>3.10. RFKill</h2>
          </div>
        </div>
      </div>
      <a id="idm236141668960" class="indexterm"></a>
      <a id="idm236141667088" class="indexterm"></a>
      <a id="idm236141666192" class="indexterm"></a>
      <a id="idm236141664304" class="indexterm"></a>
      <div class="para">
         Many computer systems contain radio transmitters, including Wi-Fi, Bluetooth, and 3G devices. These devices consume power, which is wasted when the device is not in use.
      </div>
      <div class="para">
        <em class="firstterm">RFKill</em> is a subsystem in the Linux kernel that provides an interface through which radio transmitters in a computer system can be queried, activated, and deactivated. When transmitters are deactivated, they can be placed in a state where software can reactive them (a <em class="firstterm">soft block</em>) or where software cannot reactive them (a <em class="firstterm">hard block</em>).
      </div>
      <div class="para">
         The RFKill core provides the application programming interface (API) for the subsystem. Kernel drivers that have been designed to support RFkill use this API to register with the kernel, and include methods for enabling and disabling the device. Additionally, the RFKill core provides notifications that user applications can interpret and ways for user applications to query transmitter states.
      </div>
      <div class="para">
         The RFKill interface is located at <code class="filename">/dev/rfkill</code>, which contains the current state of all radio transmitters on the system. Each device has its current RFKill state registered in <code class="filename">sysfs</code>. Additionally, RFKill issues <em class="firstterm">uevents</em> for each change of state in an RFKill-enabled device.
      </div>
      <div class="para">
        <span class="application"><strong>Rfkill</strong></span> is a command-line tool with which you can query and change RFKill-enabled devices on the system. To obtain the tool, install the <span class="package">rfkill</span> package.
      </div>
      <div class="para">
         Use the command <code class="command">rfkill list</code> to obtain a list of devices, each of which has an <em class="firstterm">index number</em> associated with it, starting at <code class="literal">0</code>. You can use this index number to tell <span class="application"><strong>rfkill</strong></span> to block or unblock a device, for example:
      </div>
      <pre class="screen">
        <code class="command">rfkill block 0</code>
      </pre>
      <div class="para">
         blocks the first RFKill-enabled device on the system.
      </div>
      <div class="para">
         You can also use <span class="application"><strong>rfkill</strong></span> to block certain categories of devices, or all RFKill-enabled devices. For example:
      </div>
      <pre class="screen">
        <code class="command">rfkill block wifi</code>
      </pre>
      <div class="para">
         blocks all Wi-Fi devices on the system. To block all RFKill-enabled devices, run:
      </div>
      <pre class="screen">
        <code class="command">rfkill block all</code>
      </pre>
      <div class="para">
         To unblock devices, run <code class="command">rfkill unblock</code> instead of <code class="command">rfkill block</code>. To obtain a full list of device categories that <span class="application"><strong>rfkill</strong></span> can block, run <code class="command">rfkill help</code>
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Optimizations_in_User_Space"></a>3.11. Optimizations in User Space</h2>
          </div>
        </div>
      </div>
      <div class="para">
         Reducing the amount of work performed by system hardware is fundamental to saving power. Therefore, although the changes described in <a class="xref" href="#Core_Infrastructure">Chapter 3, <em>Core Infrastructure and Mechanics</em></a> permit the system to operate in various states of reduced power consumption, applications in user space that request unnecessary work from system hardware prevent the hardware from entering those states. During the development of Red Hat Enterprise Linux 6, audits were undertaken in the following areas to reduce unnecessary demands on hardware:
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Reduced wakeups
        </div>
         Red Hat Enterprise Linux 6 uses a <em class="firstterm">tickless kernel</em> (refer to <a class="xref" href="#Tickless-kernel">Section 3.4, “Tickless Kernel”</a>), which allows the CPUs to remain in deeper idle states longer. However, the <em class="firstterm">timer tick</em> is not the only source of excessive CPU wakeups, and function calls from applications can also prevent the CPU from entering or remaining in idle states. Unnecessary function calls were reduced in over 50 applications.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Reduced storage and network IO
        </div>
         Input or output (IO) to storage devices and network interfaces forces devices to consume power. In storage and network devices that feature reduced power states when idle (for example, ALPM or ASPM), this traffic can prevent the device from entering or remaining in an idle state, and can prevent hard drives from spinning down when not in use. Excessive and unnecessary demands on storage have been minimized in several applications. In particular, those demands that prevented hard drives from spinning down.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Initscript audit
        </div>
         Services that start automatically whether required or not have great potential to waste system resources. Services instead should default to "off" or "on demand" wherever possible. For example, the <span class="application"><strong>BlueZ</strong></span> service that enables Bluetooth support previously ran automatically when the system started, whether Bluetooth hardware was present or not. The <span class="application"><strong>BlueZ</strong></span> initscript now checks that Bluetooth hardware is present on the system before starting the service.
      </div>
    </div>
  </div>
  <div class="chapter">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a id="Use_Cases"></a>Use Cases</h1>
        </div>
      </div>
    </div>
    <div class="toc">
      <dl class="toc">
        <dt><span class="section"><a href="#Example_Server">4.1. Example â Server</a></span></dt>
        <dt><span class="section"><a href="#Example_Laptop">4.2. Example â Laptop</a></span></dt>
      </dl>
    </div>
    <div class="para">
       This chapter describes two types of use case to illustrate the analysis and configuration methods described elsewhere in this guide. The first example considers typical servers and the second is a typical laptop.
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Example_Server"></a>4.1. Example â Server</h2>
          </div>
        </div>
      </div>
      <div class="para">
         A typical standard server nowadays comes with basically all of the necessary hardware features supported in Red Hat Enterprise Linux 6. The first thing to take into consideration is the kinds of workloads for which the server will mainly be used. Based on this information you can decide which components can be optimized for power savings.
      </div>
      <div class="para">
         Regardless of the type of server, graphics performance is generally not required. Therefore, GPU power savings can be left turned on.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Webserver
        </div>
         A webserver needs network and disk I/O. Depending on the external connection speed 100Mbit/s might be enough. If the machine serves mostly static pages, CPU performance might not be very important. Power-management choices might therefore include:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
             no disk or network plugins for <span class="application"><strong>tuned</strong></span>.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             ALPM turned on.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
            <code class="systemitem">ondemand</code> governor turned on.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             network card limited to 100Mbit/s.
          </div>
          </li>
        </ul>
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Compute server
        </div>
         A compute server mainly needs CPU. Power management choices might include:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
             depending on the jobs and where data storage happens, disk or network plugins for <span class="application"><strong>tuned</strong></span>; or for batch-mode systems, fully active <span class="application"><strong>tuned</strong></span>.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             depending on utilization, perhaps the <code class="systemitem">performance</code> governor.
          </div>
          </li>
        </ul>
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Mailserver
        </div>
         A mailserver needs mostly disk I/O and CPU. Power management choices might include:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
            <code class="systemitem">ondemand</code> governor turned on, because the last few percent of CPU performance are not important.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             no disk or network plugins for <span class="application"><strong>tuned</strong></span>.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             network speed should not be limited, because mail is often internal and can therefore benefit from a 1Gbit/s or 10Gbit/s link.
          </div>
          </li>
        </ul>
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Fileserver
        </div>
         Fileserver requirements are similar to those of a mailserver, but depending on the protocol used, might require more CPU performance. Typically, Samba-based servers require more CPU than NFS, and NFS typically requires more than iSCSI. Even so, you should be able to use the <code class="systemitem">ondemand</code> governor.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Directory server
        </div>
         A directory server typically has lower requirements for disk I/O, especially if equipped with enough RAM. Network latency is important although network I/O less so. You might consider latency network tuning with a lower link speed, but you should test this carefully for your particular network.
      </div>
    </div>
    <div xml:lang="en-US" class="section" lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Example_Laptop"></a>4.2. Example â Laptop</h2>
          </div>
        </div>
      </div>
      <div class="para">
         One other very common place where power management and savings can really make a difference are laptops. As laptops by design normally already use drastically less energy than workstations or servers the potential for absolute savings are less than for other machines. When in battery mode, though, any saving can help to get a few more minutes of battery life out of a laptop. Although this section focuses on laptops in battery mode, but you certainly can still use some or all of those tunings while running on AC power as well.
      </div>
      <div class="para">
         Savings for single components usually make a bigger relative difference on laptops than they do on workstations. For example, a 1Gbit/s network interface running at 100Mbits/s saves around 3â4watts. For a typical server with a total power consumption of around 400watts, this saving is approximately 1%. On a laptop with a total power consumption of around 40watts, the power saving on just this one component amounts to 10% of the total.
      </div>
      <div class="para">
         Specific power-saving optimizations on a typical laptop include:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
             Configure the system BIOS to disable all hardware that you do not use. For example, parallel or serial ports, card readers, webcams, WiFi, and Bluetooth just to name a few possible candidates.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             Dim the display in darker environments where you do not need full illumination to read the screen comfortably. Use <span class="guimenu"><strong>System</strong></span>+<span class="guimenu"><strong>Preferences</strong></span> → <span class="guimenuitem"><strong>Power Management</strong></span> on the GNOME desktop, <span class="guimenu"><strong>Kickoff Application Launcher</strong></span>+<span class="guimenu"><strong>Computer</strong></span>+<span class="guimenu"><strong>System Settings</strong></span>+<span class="guimenu"><strong>Advanced</strong></span> → <span class="guimenuitem"><strong>Power Management</strong></span> on the KDE desktop; or <span class="application"><strong>gnome-power-manager</strong></span> or <span class="application"><strong>xbacklight</strong></span> at the command line; or the function keys on your laptop.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             Use the <code class="systemitem">laptop-battery-powersave</code> profile of <span class="application"><strong>tuned-adm</strong></span> to enable a whole set of power-saving mechanisms. Note that performance and latency for the hard drive and network interface are impacted.
          </div>
          </li>
        </ul>
      </div>
      <div class="para">
         Additionally (or alternatively) you can perform many small adjustments to various system settings:
      </div>
      <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
        <ul>
          <li class="listitem">
          <div class="para">
             use the <code class="systemitem">ondemand</code> governor (enabled by default in Red Hat Enterprise Linux 6)
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             enable laptop mode (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">echo 5 /proc/sys/vm/laptop_mode</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             increase flush time to disk (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">echo 1500 /proc/sys/vm/dirty_writeback_centisecs</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             disable nmi watchdog (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">echo 0 /proc/sys/kernel/nmi_watchdog</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             enable AC97 audio power-saving (enabled by default in Red Hat Enterprise Linux 6):
          </div>
          <pre class="screen">
            <code class="command">echo Y /sys/module/snd_ac97_codec/parameters/power_save</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             enable multi-core power-saving (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">echo 1 /sys/devices/system/cpu/sched_mc_power_savings</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             enable USB auto-suspend:
          </div>
          <pre class="screen">
            <code class="command">for i in /sys/bus/usb/devices/*/power/autosuspend; do echo 1 $i; done</code>
          </pre>
          <div class="para">
             Note that USB auto-suspend does not work correctly with all USB devices.
          </div>
          </li>
          <li class="listitem">
          <div class="para">
             enable minimum power setting for ALPM (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">echo min_power /sys/class/scsi_host/host*/link_power_management_policy</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             mount filesystem using relatime (default in Red Hat Enterprise Linux 6):
          </div>
          <pre class="screen">
            <code class="command">mount -o remount,relatime <em class="replaceable"><code>mountpoint</code></em></code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             activate best power saving mode for hard drives (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">hdparm -B 1 -S 200 /dev/sd*</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             disable CD-ROM polling (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">hal-disable-polling --device /dev/scd*</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             reduce screen brightness to <code class="literal">50</code> or less, for example:
          </div>
          <pre class="screen">
            <code class="command">xbacklight -set 50</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             activate DPMS for screen idle:
          </div>
          <pre class="screen">
            <code class="command">xset +dpms; xset dpms 0 0 300</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             reduce Wi-Fi power levels (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">for i in /sys/bus/pci/devices/*/power_level ; do echo 5 $i ; done</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             deactivate Wi-Fi:
          </div>
          <pre class="screen">
            <code class="command">echo 1 /sys/bus/pci/devices/*/rf_kill</code>
          </pre>
          </li>
          <li class="listitem">
          <div class="para">
             limit wired network to 100Mbit/s (part of the <code class="systemitem">laptop-battery-powersave</code> profile):
          </div>
          <pre class="screen">
            <code class="command">ethtool -s eth0 advertise 0x0F</code>
          </pre>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div xml:lang="en-US" class="appendix" lang="en-US">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a id="Developer_Tips"></a>Tips for Developers</h1>
        </div>
      </div>
    </div>
    <div class="para">
       Every good programming textbook covers problems with memory allocation and the performance of specific functions. As you develop your software, be aware of issues that might increase power consumption on the systems on which the software runs. Although these considerations do not affect every line of code, you can optimize your code in areas which are frequent bottlenecks for performance.
    </div>
    <div class="para">
       Some techniques that are often problematic include:
    </div>
    <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist">
      <ul>
        <li class="listitem">
        <div class="para">
           using threads.
        </div>
        </li>
        <li class="listitem">
        <div class="para">
           unnecessary CPU wake-ups and not using wake-ups efficiently. If you must wake up, do everything at once (race to idle) and as quickly as possible.
        </div>
        </li>
        <li class="listitem">
        <div class="para">
           using <code class="function">[f]sync()</code> unnecessarily.
        </div>
        </li>
        <li class="listitem">
        <div class="para">
           unnecessary active polling or using short, regular timeouts. (React to events instead).
        </div>
        </li>
        <li class="listitem">
        <div class="para">
           not using wake-ups efficiently.
        </div>
        </li>
        <li class="listitem">
        <div class="para">
           inefficient disk access. Use large buffers to avoid frequent disk access. Write one large block at a time.
        </div>
        </li>
        <li class="listitem">
        <div class="para">
           inefficient use of timers. Group timers across applications (or even across systems) if possible.
        </div>
        </li>
        <li class="listitem">
        <div class="para">
           excessive I/O, power consumption, or memory usage (including memory leaks)
        </div>
        </li>
        <li class="listitem">
        <div class="para">
           performing unnecessary computation.
        </div>
        </li>
      </ul>
    </div>
    <div class="para">
       The following sections examine some of these areas in greater detail.
    </div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Developer_Tips-Threads"></a>A.1. Using Threads</h2>
          </div>
        </div>
      </div>
      <div class="para">
         It is widely believed that using threads makes applications perform better and faster, but this is not true in every case.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Python
        </div>
         Python uses the Global Lock Interpreter<a id="idm236141541360"></a><a xmlns:d="http://docbook.org/ns/docbook" href="#ftn.idm236141541360" class="footnote"><sup class="footnote">[1]</sup></a>, so threading is profitable only for larger I/O operations. <span class="application"><strong>Unladen-swallow</strong></span><a id="idm236141539312"></a><a xmlns:d="http://docbook.org/ns/docbook" href="#ftn.idm236141539312" class="footnote"><sup class="footnote">[2]</sup></a> is a faster implementation of Python with which you might be able to optimize your code.
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          Perl
        </div>
         Perl threads were originally created for applications running on systems without forking (such as systems with 32-bit Windows operating systems). In Perl threads, the data is copied for every single thread (Copy On Write). Data is not shared by default, because users should be able to define the level of data sharing. For data sharing the <span class="application"><strong>threads::shared</strong></span> module has to be included. However, data is not only then copied (Copy On Write), but the module also creates tied variables for the data, which takes even more time and is even slower. <a id="idm236141534368"></a><a xmlns:d="http://docbook.org/ns/docbook" href="#ftn.idm236141534368" class="footnote"><sup class="footnote">[3]</sup></a>
      </div>
      <div class="formalpara">
        <div xmlns:d="http://docbook.org/ns/docbook" class="title">
          C
        </div>
         C threads share the same memory, each thread has its own stack, and the kernel does not have to create new file descriptors and allocate new memory space. C can really use the support of more CPUs for more threads. Therefore, to maximize the performance of your threads, use a low-level language like C or C++. If you use a scripting language, consider writing a C binding. Use profilers to identify poorly performing parts of your code. <a id="idm236141530896"></a><a xmlns:d="http://docbook.org/ns/docbook" href="#ftn.idm236141530896" class="footnote"><sup class="footnote">[4]</sup></a>
      </div>
    </div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Developer_Tips-Wake-ups"></a>A.2. Wake-ups</h2>
          </div>
        </div>
      </div>
      <div class="para">
         Many applications scan configuration files for changes. In many cases, the scan is performed at a fixed interval, for example, every minute. This can be a problem, because it forces a disk to wake up from spindowns. The best solution is to find a good interval, a good checking mechanism, or to check for changes with <span class="application"><strong>inotify</strong></span> and react to events. <span class="application"><strong>Inotify</strong></span> can check variety of changes on a file or a directory.
      </div>
      <div class="para">
         For example:
      </div>
      <pre class="programlisting">
        <span class="perl_DataType">int</span> fd; fd = inotify_init(); <span class="perl_DataType">int</span> wd; <span class="perl_Comment">/* checking modification of a file - writing into */</span>
        wd = inotify_add_watch(fd, <span class="perl_String">"./myConfig"</span>, IN_MODIFY); <span class="perl_Keyword">if</span> (wd &lt; 0) { inotify_cant_be_used(); switching_back_to_previous_checking(); } ... fd_set rdfs; <span class="perl_Keyword">struct</span> timeval tv; <span class="perl_DataType">int</span> retval; FD_ZERO(&amp;rdfs); FD_SET(0, &amp;rdfs); tv.tv_sec = <span class="perl_Float">5</span>; value = select(<span class="perl_Float">1</span>, &amp;rdfs, NULL, NULL, &amp;tv); <span class="perl_Keyword">if</span> (value == <span class="perl_DecVal">-1</span>) perror(select); <span class="perl_Keyword">else</span> { do_some_stuff(); } ...
      </pre>
      <div class="para">
         The advantage of this approach is the variety of checks that you can perform.
      </div>
      <div class="para">
         The main limitation is that only a limited number of watches are available on a system. The number can be obtained from <code class="filename">/proc/sys/fs/inotify/max_user_watches</code> and although it can be changed, this is not recommended. Furthermore, in case <span class="application"><strong>inotify</strong></span> fails, the code has to fall back to a different check method, which usually means many occurrences of <code class="code">#if #define</code> in the source code.
      </div>
      <div class="para">
         For more information on <span class="application"><strong>inotify</strong></span>, refer to the <span class="citerefentry"><span class="refentrytitle">inotify</span>
        </span> man page.
      </div>
    </div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="Developer_Tips-Fsync"></a>A.3. Fsync</h2>
          </div>
        </div>
      </div>
      <div class="para">
        <code class="function">Fsync</code> is known as an I/O expensive operation, but this is is not completely true. For example, refer to Theodore Ts'o's article <em class="citetitle">Don't fear the fsync!</em><a id="idm236141515712"></a><a xmlns:d="http://docbook.org/ns/docbook" href="#ftn.idm236141515712" class="footnote"><sup class="footnote">[5]</sup></a> and the accompanying discussion.
      </div>
      <div class="para">
        <span class="application"><strong>Firefox</strong></span> used to call the <span class="application"><strong>sqlite</strong></span> library each time the user clicked on a link to go to a new page. <span class="application"><strong>Sqlite</strong></span> called <code class="function">fsync</code> and because of the file system settings (mainly ext3 with data-ordered mode), there was a long latency when nothing happened. This could take a long time (up to 30 seconds) if another process was copying a large file at the same time.
      </div>
      <div class="para">
         However, in other cases, where <code class="function">fsync</code> wasn't used at all, problems emerged with the switch to the ext4 file system. Ext3 was set to data-ordered mode, which flushed memory every few seconds and saved it to a disk. But with ext4 and laptop_mode, the interval between saves was longer and data might get lost when the system was unexpectedly switched off. Now ext4 is patched, but we must still consider the design of our applications carefully, and use <code class="function">fsync</code> as appropriate.
      </div>
      <div class="para">
         The following simple example of reading and writing into a configuration file shows how a backup of a file can be made or how data can be lost:
      </div>
      <pre class="programlisting">
        <span class="perl_Comment">/* open and read configuration file e.g. ~/.kde/myconfig */</span>
        fd = open(<span class="perl_String">"./kde/myconfig"</span>, O_WRONLY|O_TRUNC|O_CREAT); read(myconfig); ... write(fd, bufferOfNewData, <span class="perl_Keyword">sizeof</span>(bufferOfNewData)); close(fd);
      </pre>
      <div class="para">
         A better approach would be:
      </div>
      <pre class="programlisting">
        open(<span class="perl_String">"/.kde/myconfig"</span>, O_WRONLY|O_TRUNC|O_CREAT); read(myconfig); ... fd = open(<span class="perl_String">"/.kde/myconfig.suffix"</span>, O_WRONLY|O_TRUNC|O_CREAT); write(fd, bufferOfNewData, <span class="perl_Keyword">sizeof</span>(bufferOfNewData)); fsync; <span class="perl_Comment">/* paranoia - optional */</span>
        ... close(fd); rename(<span class="perl_String">"/.kde/myconfig"</span>, <span class="perl_String">"/.kde/myconfig~"</span>); <span class="perl_Comment">/* paranoia - optional */</span>
        rename(<span class="perl_String">"/.kde/myconfig.suffix"</span>, <span class="perl_String">"/.kde/myconfig"</span>);
      </pre>
    </div>
    <div class="footnotes">
      <br/>
      <hr width="100" align="left"/>
      <div id="ftn.idm236141541360" class="footnote">
        <div class="para">
          <a href="#idm236141541360" class="para"><sup class="para">[1] </sup></a>
          <code class="uri"><a class="uri" href="http://docs.python.org/c-api/init.html#thread-state-and-the-global-interpreter-lock">http://docs.python.org/c-api/init.html#thread-state-and-the-global-interpreter-lock</a></code>
        </div>
      </div>
      <div id="ftn.idm236141539312" class="footnote">
        <div class="para">
          <a href="#idm236141539312" class="para"><sup class="para">[2] </sup></a>
          <code class="uri"><a class="uri" href="http://code.google.com/p/unladen-swallow/">http://code.google.com/p/unladen-swallow/</a></code>
        </div>
      </div>
      <div id="ftn.idm236141534368" class="footnote">
        <div class="para">
          <a href="#idm236141534368" class="para"><sup class="para">[3] </sup></a>
          <code class="uri"><a class="uri" href="http://www.perlmonks.org/?node_id=288022">http://www.perlmonks.org/?node_id=288022</a></code>
        </div>
      </div>
      <div id="ftn.idm236141530896" class="footnote">
        <div class="para">
          <a href="#idm236141530896" class="para"><sup class="para">[4] </sup></a>
          <code class="uri"><a class="uri" href="http://people.redhat.com/drepper/lt2009.pdf">http://people.redhat.com/drepper/lt2009.pdf</a></code>
        </div>
      </div>
      <div id="ftn.idm236141515712" class="footnote">
        <div class="para">
          <a href="#idm236141515712" class="para"><sup class="para">[5] </sup></a>
          <code class="uri"><a class="uri" href="http://thunk.org/tytso/blog/2009/03/15/dont-fear-the-fsync/">http://thunk.org/tytso/blog/2009/03/15/dont-fear-the-fsync/</a></code>
        </div>
      </div>
    </div>
  </div>
  <div xml:lang="en-US" class="appendix" lang="en-US">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a id="appe-Publican-Revision_History"></a>Revision History</h1>
        </div>
      </div>
    </div>
    <div xmlns:d="http://docbook.org/ns/docbook" class="para">
      <p>
      </p>
      <div class="revhistory">
        <table summary="Revision History">
        <tr>
          <th align="left" valign="top" colspan="3">
            <strong>Revision History</strong>
          </th>
        </tr>
        <tr>
          <td align="left">
            Revision 1.0-2
          </td>
          <td align="left">
            Fri Oct 22 2010
          </td>
          <td align="left">
            <span class="author"><span class="firstname">RÃÂÃÂ¼diger</span><span class="surname">Landmann</span></span>
          </td>
        </tr>
        <tr>
          <td align="left" colspan="3">
            <table border="0" summary="Simple list" class="simplelist">
            <tr>
              <td>
                correct minor errors in text
              </td>
            </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td align="left">
            Revision 1.0-1
          </td>
          <td align="left">
            Thu Oct 7 2010
          </td>
          <td align="left">
            <span class="author"><span class="firstname">RÃÂÃÂ¼diger</span><span class="surname">Landmann</span></span>
          </td>
        </tr>
        <tr>
          <td align="left" colspan="3">
            <table border="0" summary="Simple list" class="simplelist">
            <tr>
              <td>
                remove "draft" tag
              </td>
            </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td align="left">
            Revision 1.0-0
          </td>
          <td align="left">
            Thu Oct 7 2010
          </td>
          <td align="left">
            <span class="author"><span class="firstname">RÃÂÃÂ¼diger</span><span class="surname">Landmann</span></span>
          </td>
        </tr>
        <tr>
          <td align="left" colspan="3">
            <table border="0" summary="Simple list" class="simplelist">
            <tr>
              <td>
                GA release
              </td>
            </tr>
            </table>
          </td>
        </tr>
        </table>
      </div>
    </div>
  </div>
</div>



<script type="text/javascript" src="helpers.js"></script>

</body>
</html>
